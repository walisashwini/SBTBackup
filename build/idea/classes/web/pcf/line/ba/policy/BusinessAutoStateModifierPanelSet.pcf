<?xml version="1.0"?>
<PCF
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="../../../../../../../pcf.xsd">
  <PanelSet
    id="BusinessAutoStateModifierPanelSet">
    <Require
      name="baLine"
      type="BusinessAutoLine"/>
    <Require
      name="jurisdiction"
      type="BAJurisdiction"/>
    <Variable
      initialValue="jurisdiction.BAJurisModifiers"
      name="modifiers"
      recalculateOnRefresh="true"
      type="entity.BAJurisModifier[]"/>
    <Variable
      initialValue="new gw.pcf.ModifiersListViewHelper(modifiers)"
      name="modifiersLVHelper"
      recalculateOnRefresh="true"
      type="gw.pcf.ModifiersListViewHelper"/>
    <ListViewPanel>
      <Variable
        initialValue="modifiersLVHelper.NonSchedRateModifiers"
        name="nonSchedRateModifiers"
        recalculateOnRefresh="true"
        type="entity.Modifier[]"/>
      <Variable
        initialValue="modifiersLVHelper.AllDisplayJustificationsFalse"
        name="allDisplayJustificationsFalse"
        type="boolean"/>
      <RowIterator
        editable="true"
        elementName="modifier"
        id="RateModifiers"
        pageSize="0"
        value="nonSchedRateModifiers.where(\ mod -&gt; mod.DataType == ModifierDataType.TC_RATE)"
        valueType="entity.Modifier[]">
        <IteratorSort
          sortBy="modifier.Pattern.Priority"
          sortOrder="1"/>
        <Row>
          <TextCell
            align="left"
            id="Category"
            label="DisplayKey.get(&quot;Web.Policy.RatingInputs.Category&quot;)"
            value="modifier.Pattern.Name"/>
          <BooleanRadioCell
            editable="modifier.Pattern.DisplayEligibility"
            id="Eligibility"
            label="DisplayKey.get(&quot;Web.Policy.Modifiers.Eligible&quot;)"
            value="modifier.Eligible">
            <PostOnChange
              onChange="clearModifier(modifier)"/>
          </BooleanRadioCell>
          <TextCell
            align="left"
            id="Minimum"
            label="DisplayKey.get(&quot;Web.Policy.RatingInputs.Minimum&quot;)"
            value="modifier.Minimum"
            valueType="java.math.BigDecimal"
            valueVisible="modifier.Pattern.ModifierDataType == TC_RATE and modifier.Pattern.DisplayRange"/>
          <TextCell
            align="left"
            id="Maximum"
            label="DisplayKey.get(&quot;Web.Policy.RatingInputs.Maximum&quot;)"
            value="modifier.Maximum"
            valueType="java.math.BigDecimal"
            valueVisible="modifier.Pattern.ModifierDataType == TC_RATE and modifier.Pattern.DisplayRange"/>
          <TextCell
            align="right"
            editable="true"
            id="Rate"
            label="DisplayKey.get(&quot;Web.Policy.PolicyLine.PerState.Modifiers.Value&quot;)"
            requestValidationExpression="modifier.getModifierValidation(VALUE)"
            value="modifier.RateModifier"
            valueType="java.math.BigDecimal"
            valueVisible="modifier.Eligible"/>
          <BooleanRadioCell
            editable="modifier.Pattern.DisplayValueFinal"
            id="ValueFinal"
            label="DisplayKey.get(&quot;Web.Policy.Modifiers.ValueFinal&quot;)"
            value="modifier.ValueFinal"
            valueVisible="modifier.Eligible"/>
          <TextCell
            align="left"
            editable="modifier.Pattern.DisplayJustification"
            id="Justification"
            label="DisplayKey.get(&quot;Web.Policy.RatingInputs.Justification&quot;)"
            value="modifier.Justification"
            valueVisible="modifier.Eligible"
            visible="allDisplayJustificationsFalse"/>
          <DateCell
            align="left"
            id="Effective"
            label="DisplayKey.get(&quot;Web.Policy.PolicyLine.PerState.Modifiers.EffectiveDate&quot;)"
            value="modifier.EffectiveDate"
            valueVisible="modifier.Eligible"/>
          <DateCell
            align="left"
            id="Expiration"
            label="DisplayKey.get(&quot;Web.Policy.PolicyLine.PerState.Modifiers.ExpirationDate&quot;)"
            value="modifier.ExpirationDate"
            valueVisible="modifier.Eligible"/>
        </Row>
      </RowIterator>
      <RowIterator
        editable="true"
        elementName="modifier"
        id="NonRateModifiers"
        pageSize="0"
        value="nonSchedRateModifiers.where(\ mod -&gt; mod.DataType != ModifierDataType.TC_RATE)"
        valueType="entity.Modifier[]">
        <IteratorSort
          sortBy="modifier.Pattern.Priority"
          sortOrder="1"/>
        <Row>
          <TextCell
            align="left"
            id="Category"
            value="modifier.Pattern.Name"/>
          <BooleanRadioCell
            editable="modifier.Pattern.DisplayEligibility"
            id="Eligibility"
            value="modifier.Eligible">
            <PostOnChange
              onChange="clearModifier(modifier)"/>
          </BooleanRadioCell>
          <TextCell
            align="left"
            id="Minimum"
            value="modifier.Minimum"
            valueType="java.math.BigDecimal"
            valueVisible="modifier.Pattern.ModifierDataType == TC_RATE and modifier.Pattern.DisplayRange"/>
          <TextCell
            align="left"
            id="Maximum"
            value="modifier.Maximum"
            valueType="java.math.BigDecimal"
            valueVisible="modifier.Pattern.ModifierDataType == TC_RATE and modifier.Pattern.DisplayRange"/>
          <ModifierCell
            align="right"
            editable="true"
            id="Value"
            value="modifier"
            valueVisible="modifier.Eligible"/>
          <BooleanRadioCell
            editable="modifier.Pattern.DisplayValueFinal"
            id="ValueFinal"
            value="modifier.ValueFinal"
            valueVisible="modifier.Eligible"/>
          <TextCell
            align="left"
            editable="modifier.Pattern.DisplayJustification"
            id="Justification"
            value="modifier.Justification"
            valueVisible="modifier.Eligible"
            visible="allDisplayJustificationsFalse"/>
          <DateCell
            align="left"
            id="Effective"
            value="modifier.EffectiveDate"
            valueVisible="modifier.Eligible"/>
          <DateCell
            align="left"
            id="Expiration"
            value="modifier.ExpirationDate"
            valueVisible="modifier.Eligible"/>
        </Row>
      </RowIterator>
    </ListViewPanel>
    <!-- <PanelRef>
      <ListViewPanel
        id="ModifiersLV">
        <Variable
          initialValue="CurrentLocation.InEditMode and modifiers != null"
          name="modifiersUpdated"/>
        <RowIterator
          editable="true"
          elementName="modifier"
          value="modifiers">
          <IteratorSort
            sortBy="modifier.Pattern.Priority"
            sortOrder="1"/>
          <Row>
            <TextCell
              id="Category"
              label="DisplayKey.get(&quot;Web.Policy.RatingInputs.Category&quot;)"
              value="modifier.Pattern.Name"/>
            <Cell
              editable="modifier.Pattern.DisplayEligibility"
              id="Eligibility"
              label="DisplayKey.get(&quot;Web.Policy.Modifiers.Eligible&quot;)"
              onChange="clearModifier(modifier)"
              postOnChange="true"
              value="modifier.Eligible"/>
            <Cell
              id="Minimum"
              label="DisplayKey.get(&quot;Web.Policy.RatingInputs.Minimum&quot;)"
              value="modifier.Minimum"
              valueVisible="modifier.Pattern.ModifierDataType == &quot;rate&quot; and modifier.Pattern.DisplayRange"/>
            <Cell
              id="Maximum"
              label="DisplayKey.get(&quot;Web.Policy.RatingInputs.Maximum&quot;)"
              value="modifier.Maximum"
              valueVisible="modifier.Pattern.ModifierDataType == &quot;rate&quot; and modifier.Pattern.DisplayRange"/>
            <ModifierCell
              editable="true"
              id="Value"
              label="DisplayKey.get(&quot;Web.Policy.PolicyLine.PerState.Modifiers.Value&quot;)"
              requestValidationExpression="modifier.getModifierValidation(VALUE as String)"
              value="modifier"
              valueVisible="modifier.Eligible"/>
            <Cell
              editable="modifier.Pattern.DisplayValueFinal"
              id="ValueFinal"
              label="DisplayKey.get(&quot;Web.Policy.Modifiers.ValueFinal&quot;)"
              value="modifier.ValueFinal"
              valueVisible="modifier.Eligible"/>
            <TextCell
              editable="modifier.Pattern.DisplayJustification"
              id="Justification"
              label="DisplayKey.get(&quot;Web.Policy.RatingInputs.Justification&quot;)"
              value="modifier.Justification"
              valueVisible="modifier.Eligible"
              visible="gw.pcf.ModifiersListViewHelper.falseIfAllDisplayJustificationsFalse(modifiers)"/>
            <DateCell
              id="Effective"
              label="DisplayKey.get(&quot;Web.Policy.PolicyLine.PerState.Modifiers.EffectiveDate&quot;)"
              value="modifier.EffectiveDate"
              valueVisible="modifier.Eligible"/>
            <DateCell
              id="Expiration"
              label="DisplayKey.get(&quot;Web.Policy.PolicyLine.PerState.Modifiers.ExpirationDate&quot;)"
              value="modifier.ExpirationDate"
              valueVisible="modifier.Eligible"/>
          </Row>
        </RowIterator>
      </ListViewPanel>
    </PanelRef> -->
    <PanelRef
      def="ScheduleRateDV(modifiersLVHelper.SchedRateModifiers)"/>
    <Code><![CDATA[function clearModifier(mod: Modifier) : Modifier {
  mod.BooleanModifier = null
  mod.RateModifier = null
  mod.DateModifier = null
  mod.TypeKeyModifier = null
  mod.Justification = null
  return mod
}]]></Code>
  </PanelSet>
</PCF>
<?xml version="1.0"?>
<PCF
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="../../../../../pcf.xsd">
  <Page
    afterEnter="gw.api.web.PebblesUtil.addWebMessages(CurrentLocation, policyPeriod.PolicyFileMessages)"
    canVisit="perm.PolicyPeriod.view(policyPeriod) and (perm.System.viewriskrefreasons or perm.System.viewriskclaims or perm.System.viewriskpriorpolicies or perm.System.viewriskpriorlosses)"
    id="PolicyFile_RiskAnalysis"
    title="DisplayKey.get(&quot;Web.PolicyFile.RiskAnalysis&quot;)">
    <LocationEntryPoint
      signature="PolicyFile_RiskAnalysis(policyPeriod : PolicyPeriod, asOfDate : java.util.Date)"/>
    <Variable
      name="policyPeriod"
      type="PolicyPeriod"/>
    <Variable
      name="asOfDate"
      type="java.util.Date"/>
    <Screen
      id="PolicyFile_RiskAnalysisScreen">
      <TitleBar/>
      <PanelRef
        def="WarningsPanelSet(policyPeriod.Policy.ContingencyWarningMessages)"/>
      <CardViewPanel
        id="PolicyFile_RiskAnalysisCV">
        <Variable
          initialValue="gw.web.policy.UWReferralReasonsModalRowOrganizer.organize(policyPeriod.Policy.UWReferralReasons)"
          name="organizedReasons"
          recalculateOnRefresh="true"
          type="gw.web.policy.UWReferralReasonModalRow[]"/>
        <Card
          id="PolicyFile_UWReferralReasonCard"
          title="DisplayKey.get(&quot;Web.PolicyFile.UWReferralReasons&quot;)"
          visible="perm.System.viewriskrefreasons">
          <PanelRef>
            <Toolbar>
              <CheckedValuesToolbarButton
                checkedRowAction="CheckedValue.closeReferralReasonAndCommit()"
                flags="all closable"
                id="CloseUWReferralReason"
                iterator="UWReferralReasonsLV"
                label="DisplayKey.get(&quot;Web.UWReferralReasonLV.Close&quot;)"/>
              <CheckedValuesToolbarButton
                checkedRowAction="CheckedValue.openReferralReasonAndCommit()"
                flags="all reopenable"
                id="ReopenUWReferralReason"
                iterator="UWReferralReasonsLV"
                label="DisplayKey.get(&quot;Web.UWReferralReasonLV.Reopen&quot;)"/>
              <CheckedValuesToolbarButton
                allCheckedRowsAction="ReferralReasonDetailsPopup.push(CheckedValues*.Item)"
                id="ViewUWReferralReason"
                iterator="UWReferralReasonsLV"
                label="DisplayKey.get(&quot;Web.UWReferralReasonLV.ViewDetails&quot;)"/>
              <ToolbarButton
                action="NewUWReferralReasonPopup.push(policyPeriod.Policy)"
                id="AddUWReferralReason"
                label="DisplayKey.get(&quot;Web.UWReferralReasonLV.AddUWReferralReason&quot;)"
                visible="perm.System.createreferralreason"/>
            </Toolbar>
            <ListViewPanel
              id="UWReferralReasonsLV">
              <RowIterator
                canPick="modalRow.IsItem"
                checkBoxVisible="modalRow.IsItem"
                editable="true"
                elementName="modalRow"
                hasCheckBoxes="true"
                value="organizedReasons"
                valueType="gw.web.policy.UWReferralReasonModalRow[]">
                <ToolbarFlag
                  condition="modalRow.IsItem and modalRow.Open == Clickable"
                  name="reopenable"/>
                <ToolbarFlag
                  condition="modalRow.IsItem and modalRow.Close == Clickable"
                  name="closable"/>
                <RowSetRef
                  def="UWReferralReasonRowSet(modalRow)"
                  mode="modalRow.Mode"/>
              </RowIterator>
            </ListViewPanel>
          </PanelRef>
        </Card>
        <Card
          id="PolicyFile_EvaluationIssuesCard"
          title="DisplayKey.get(&quot;Web.Policy.EvaluationIssues&quot;)"
          visible="perm.System.viewriskevalissues">
          <PanelRef
            def="RiskEvaluationPanelSet(policyPeriod, false)"/>
        </Card>
        <Card
          id="PolicyFile_ContingenciesCard"
          title="DisplayKey.get('Web.Contingency.Contingencies')">
          <PanelRef
            def="ContingencyPanelSet(policyPeriod)">
            <Toolbar>
              <ToolbarButton
                action="NewContingencyPopup.push(policyPeriod.Policy)"
                id="AddContingencyButton"
                label="DisplayKey.get('Web.Policy.AddNewContingency')"/>
            </Toolbar>
          </PanelRef>
        </Card>
        <Card
          id="PolicyFile_PriorPoliciesCard"
          title="DisplayKey.get(&quot;Web.PolicyFile.PriorHistory.PriorPolicies&quot;)"
          visible="perm.System.viewriskpriorpolicies">
          <PanelRef
            def="PolicyFile_PriorHistoryDV(policyPeriod, policyPeriod.Policy)"/>
        </Card>
        <Card
          id="PolicyFile_ClaimsCard"
          title="DisplayKey.get(&quot;Web.PolicyFile.Claims&quot;)"
          visible="perm.System.viewriskclaims">
          <SearchPanel
            criteriaName="claimSearchCriteria"
            resultsName="claimSet"
            search="claimSearchCriteria.performSearch()"
            searchCriteria="policyPeriod.getNewClaimSearchCriteria(true)"
            searchCriteriaType="gw.losshistory.ClaimSearchCriteria"
            searchOnEnter="false"
            searchResultsType="ClaimSet">
            <DetailViewPanel>
              <InputColumn>
                <DateCriterionChoiceInput
                  editable="true"
                  id="DateRangeForClaimSearch"
                  label="DisplayKey.get(&quot;Web.PolicyFile.RiskAnalysis.ClaimSearch.Date&quot;)"
                  required="false"
                  value="claimSearchCriteria.DateCriteria"
                  valueType="entity.DateCriteria"/>
              </InputColumn>
              <InputFooterSection>
                <InputSetRef
                  def="SearchAndResetInputSet()"/>
              </InputFooterSection>
            </DetailViewPanel>
            <ListDetailPanel
              selectionName="selectedClaim"
              selectionType="Claim">
              <PanelRef
                def="ClaimsLV(claimSet.Claims, claimSet==null ? new gw.losshistory.ClaimPolicyPeriodFilterSet(null) : claimSet.retrieveClaimFilter(), policyPeriod.PreferredSettlementCurrency)">
                <Toolbar/>
              </PanelRef>
              <PanelRef
                def="ClaimDetailsCV(selectedClaim,false)"
                editable="false"
                visible="selectedClaim != null"/>
            </ListDetailPanel>
          </SearchPanel>
        </Card>
        <Card
          id="PolicyFile_LossHistoryCard"
          title="DisplayKey.get(&quot;Web.PolicyFile.PriorHistory.PriorLosses&quot;)"
          visible="perm.System.viewriskpriorlosses">
          <PanelRef
            def="PolicyFile_LossHistoryDV(policyPeriod, policyPeriod.Policy)"/>
        </Card>
        <Card
          id="MotorVehicleRecord"
          title="DisplayKey.get(&quot;Web.PersonalAuto.MotorVehicleRecord.MotorVehicleRecords&quot;)"
          visible="policyPeriod.PersonalAutoLineExists">
          <PanelRef
            def="MotorVehicleRecordSummary(policyPeriod)"/>
        </Card>
      </CardViewPanel>
    </Screen>
  </Page>
</PCF>
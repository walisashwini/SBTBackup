/*
 jQuery Form Plugin
 version: 4.2.2
 Requires jQuery v1.7.2 or later
 Project repository: https://github.com/jquery-form/form

 Copyright 2017 Kevin Morris
 Copyright 2006 M. Alsup

 Dual licensed under the LGPL-2.1+ or MIT licenses
 https://github.com/jquery-form/form#license

 This library is free software; you can redistribute it and/or
 modify it under the terms of the GNU Lesser General Public
 License as published by the Free Software Foundation; either
 version 2.1 of the License, or (at your option) any later version.
 This library is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 Lesser General Public License for more details.
*/
'use strict';(function($){if(!$||!window)throw new Error("Missing Jquery object or Window object in Jquery-form");"use strict";var rCRLF=/\r?\n/g;var feature={};feature.fileapi=$('\x3cinput type\x3d"file"\x3e').get(0).files!==undefined;feature.formdata=typeof window.FormData!=="undefined";var hasProp=!!$.fn.prop;$.fn.attr2=function(){if(!hasProp)return this.attr.apply(this,arguments);var val=this.prop.apply(this,arguments);if(val&&val.jquery||typeof val==="string")return val;return this.attr.apply(this,
arguments)};$.fn.ajaxSubmit=function(options,data,dataType,onSuccess){if(!this.length){log("ajaxSubmit: skipping submit process - no element selected");return this}var method,action,url,$form=this;if(typeof options==="function")options={success:options};else if(typeof options==="string"||options===false&&arguments.length>0){options={"url":options,"data":data,"dataType":dataType};if(typeof onSuccess==="function")options.success=onSuccess}else if(typeof options==="undefined")options={};method=options.method||
options.type||this.attr2("method");action=options.url||this.attr2("action");url=typeof action==="string"?$.trim(action):"";url=url||window.location.href||"";if(url)url=(url.match(/^([^#]+)/)||[])[1];options=$.extend(true,{url:url,success:$.ajaxSettings.success,type:method||$.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},options);var veto={};this.trigger("form-pre-serialize",[this,options,veto]);if(veto.veto){log("ajaxSubmit: submit vetoed via form-pre-serialize trigger");
return this}if(options.beforeSerialize&&options.beforeSerialize(this,options)===false){log("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var traditional=options.traditional;if(typeof traditional==="undefined")traditional=$.ajaxSettings.traditional;var elements=[];var qx,a=this.formToArray(options.semantic,elements,options.filtering);if(options.data){var optionsData=$.isFunction(options.data)?options.data(a):options.data;options.extraData=optionsData;qx=$.param(optionsData,
traditional)}if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false){log("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[a,this,options,veto]);if(veto.veto){log("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}var q=$.param(a,traditional);if(qx)q=q?q+"\x26"+qx:qx;if(options.type.toUpperCase()==="GET"){options.url+=(options.url.indexOf("?")>=0?"\x26":"?")+q;options.data=null}else options.data=q;var callbacks=
[];if(options.resetForm)callbacks.push(function(){$form.resetForm()});if(options.clearForm)callbacks.push(function(){$form.clearForm(options.includeHidden)});if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data,textStatus,jqXHR){var successArguments=arguments,fn=options.replaceTarget?"replaceWith":"html";$(options.target)[fn](data).each(function(){oldSuccess.apply(this,successArguments)})})}else if(options.success)if($.isArray(options.success))$.merge(callbacks,
options.success);else callbacks.push(options.success);options.success=function(data,status,xhr){var context=options.context||this;for(var i=0,max=callbacks.length;i<max;i++)callbacks[i].apply(context,[data,status,xhr||$form,$form])};if(options.error){var oldError=options.error;options.error=function(xhr,status,error){var context=options.context||this;oldError.apply(context,[xhr,status,error,$form])}}if(options.complete){var oldComplete=options.complete;options.complete=function(xhr,status){var context=
options.context||this;oldComplete.apply(context,[xhr,status,$form])}}var fileInputs=$("input[type\x3dfile]:enabled",this).filter(function(){return $(this).val()!==""});var hasFileInputs=fileInputs.length>0;var mp="multipart/form-data";var multipart=$form.attr("enctype")===mp||$form.attr("encoding")===mp;var fileAPI=feature.fileapi&&feature.formdata;log("fileAPI :"+fileAPI);var shouldUseFrame=(hasFileInputs||multipart)&&!fileAPI;var jqxhr;if(options.iframe!==false&&(options.iframe||shouldUseFrame))if(options.closeKeepAlive)$.get(options.closeKeepAlive,
function(){jqxhr=fileUploadIframe(a)});else jqxhr=fileUploadIframe(a);else if((hasFileInputs||multipart)&&fileAPI)jqxhr=fileUploadXhr(a);else jqxhr=$.ajax(options);$form.removeData("jqxhr").data("jqxhr",jqxhr);for(var k=0;k<elements.length;k++)elements[k]=null;this.trigger("form-submit-notify",[this,options]);return this;function deepSerialize(extraData){var serialized=$.param(extraData,options.traditional).split("\x26");var len=serialized.length;var result=[];var i,part;for(i=0;i<len;i++){serialized[i]=
serialized[i].replace(/\+/g," ");part=serialized[i].split("\x3d");result.push([decodeURIComponent(part[0]),decodeURIComponent(part[1])])}return result}function fileUploadXhr(a){var formdata=new FormData;for(var i=0;i<a.length;i++)formdata.append(a[i].name,a[i].value);if(options.extraData){var serializedData=deepSerialize(options.extraData);for(i=0;i<serializedData.length;i++)if(serializedData[i])formdata.append(serializedData[i][0],serializedData[i][1])}options.data=null;var s=$.extend(true,{},$.ajaxSettings,
options,{contentType:false,processData:false,cache:false,type:method||"POST"});if(options.uploadProgress)s.xhr=function(){var xhr=$.ajaxSettings.xhr();if(xhr.upload)xhr.upload.addEventListener("progress",function(event){var percent=0;var position=event.loaded||event.position;var total=event.total;if(event.lengthComputable)percent=Math.ceil(position/total*100);options.uploadProgress(event,position,total,percent)},false);return xhr};s.data=null;var beforeSend=s.beforeSend;s.beforeSend=function(xhr,
o){if(options.formData)o.data=options.formData;else o.data=formdata;if(beforeSend)beforeSend.call(this,xhr,o)};return $.ajax(s)}function fileUploadIframe(a){var form=$form[0],el,i,s,g,id,$io,io,xhr,sub,n,timedOut,timeoutHandle;var deferred=$.Deferred();deferred.abort=function(status){xhr.abort(status)};if(a)for(i=0;i<elements.length;i++){el=$(elements[i]);if(hasProp)el.prop("disabled",false);else el.removeAttr("disabled")}s=$.extend(true,{},$.ajaxSettings,options);s.context=s.context||s;id="jqFormIO"+
(new Date).getTime();var ownerDocument=form.ownerDocument;var $body=$form.closest("body");if(s.iframeTarget){$io=$(s.iframeTarget,ownerDocument);n=$io.attr2("name");if(!n)$io.attr2("name",id);else id=n}else{$io=$('\x3ciframe name\x3d"'+id+'" src\x3d"'+s.iframeSrc+'" /\x3e',ownerDocument);$io.css({position:"absolute",top:"-1000px",left:"-1000px"})}io=$io[0];xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},
setRequestHeader:function(){},abort:function(status){var e=status==="timeout"?"timeout":"aborted";log("aborting upload... "+e);this.aborted=1;try{if(io.contentWindow.document.execCommand)io.contentWindow.document.execCommand("Stop")}catch(ignore){}$io.attr("src",s.iframeSrc);xhr.error=e;if(s.error)s.error.call(s.context,xhr,e,status);if(g)$.event.trigger("ajaxError",[xhr,s,e]);if(s.complete)s.complete.call(s.context,xhr,e)}};g=s.global;if(g&&$.active++===0)$.event.trigger("ajaxStart");if(g)$.event.trigger("ajaxSend",
[xhr,s]);if(s.beforeSend&&s.beforeSend.call(s.context,xhr,s)===false){if(s.global)$.active--;deferred.reject();return deferred}if(xhr.aborted){deferred.reject();return deferred}sub=form.clk;if(sub){n=sub.name;if(n&&!sub.disabled){s.extraData=s.extraData||{};s.extraData[n]=sub.value;if(sub.type==="image"){s.extraData[n+".x"]=form.clk_x;s.extraData[n+".y"]=form.clk_y}}}var CLIENT_TIMEOUT_ABORT=1;var SERVER_ABORT=2;function getDoc(frame){var doc=null;try{if(frame.contentWindow)doc=frame.contentWindow.document}catch(err){log("cannot get iframe.contentWindow document: "+
err)}if(doc)return doc;try{doc=frame.contentDocument?frame.contentDocument:frame.document}catch(err){log("cannot get iframe.contentDocument: "+err);doc=frame.document}return doc}var csrf_token=$("meta[name\x3dcsrf-token]").attr("content");var csrf_param=$("meta[name\x3dcsrf-param]").attr("content");if(csrf_param&&csrf_token){s.extraData=s.extraData||{};s.extraData[csrf_param]=csrf_token}function doSubmit(){var t=$form.attr2("target"),a=$form.attr2("action"),mp="multipart/form-data",et=$form.attr("enctype")||
$form.attr("encoding")||mp;form.setAttribute("target",id);if(!method||/post/i.test(method))form.setAttribute("method","POST");if(a!==s.url)form.setAttribute("action",s.url);if(!s.skipEncodingOverride&&(!method||/post/i.test(method)))$form.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});if(s.timeout)timeoutHandle=setTimeout(function(){timedOut=true;cb(CLIENT_TIMEOUT_ABORT)},s.timeout);function checkState(){try{var state=getDoc(io).readyState;log("state \x3d "+state);if(state&&
state.toLowerCase()==="uninitialized")setTimeout(checkState,50)}catch(e){log("Server abort: ",e," (",e.name,")");cb(SERVER_ABORT);if(timeoutHandle)clearTimeout(timeoutHandle);timeoutHandle=undefined}}var extraInputs=[];try{if(s.extraData)for(var n in s.extraData)if(s.extraData.hasOwnProperty(n))if($.isPlainObject(s.extraData[n])&&s.extraData[n].hasOwnProperty("name")&&s.extraData[n].hasOwnProperty("value"))extraInputs.push($('\x3cinput type\x3d"hidden" name\x3d"'+s.extraData[n].name+'"\x3e',ownerDocument).val(s.extraData[n].value).appendTo(form)[0]);
else extraInputs.push($('\x3cinput type\x3d"hidden" name\x3d"'+n+'"\x3e',ownerDocument).val(s.extraData[n]).appendTo(form)[0]);if(!s.iframeTarget)$io.appendTo($body);if(io.attachEvent)io.attachEvent("onload",cb);else io.addEventListener("load",cb,false);setTimeout(checkState,15);try{form.submit()}catch(err){var submitFn=document.createElement("form").submit;submitFn.apply(form)}}finally{form.setAttribute("action",a);form.setAttribute("enctype",et);if(t)form.setAttribute("target",t);else $form.removeAttr("target");
$(extraInputs).remove()}}if(s.forceSync)doSubmit();else setTimeout(doSubmit,10);var data,doc,domCheckCount=50,callbackProcessed;function cb(e){if(xhr.aborted||callbackProcessed)return;doc=getDoc(io);if(!doc){log("cannot access response document");e=SERVER_ABORT}if(e===CLIENT_TIMEOUT_ABORT&&xhr){xhr.abort("timeout");deferred.reject(xhr,"timeout");return}else if(e===SERVER_ABORT&&xhr){xhr.abort("server abort");deferred.reject(xhr,"error","server abort");return}if(!doc||doc.location.href===s.iframeSrc)if(!timedOut)return;
if(io.detachEvent)io.detachEvent("onload",cb);else io.removeEventListener("load",cb,false);var status="success",errMsg;try{if(timedOut)throw"timeout";var isXml=s.dataType==="xml"||doc.XMLDocument||$.isXMLDoc(doc);log("isXml\x3d"+isXml);if(!isXml&&window.opera&&(doc.body===null||!doc.body.innerHTML))if(--domCheckCount){log("requeing onLoad callback, DOM not available");setTimeout(cb,250);return}var docRoot=doc.body?doc.body:doc.documentElement;xhr.responseText=docRoot?docRoot.innerHTML:null;xhr.responseXML=
doc.XMLDocument?doc.XMLDocument:doc;if(isXml)s.dataType="xml";xhr.getResponseHeader=function(header){var headers={"content-type":s.dataType};return headers[header.toLowerCase()]};if(docRoot){xhr.status=Number(docRoot.getAttribute("status"))||xhr.status;xhr.statusText=docRoot.getAttribute("statusText")||xhr.statusText}var dt=(s.dataType||"").toLowerCase();var scr=/(json|script|text)/.test(dt);if(scr||s.textarea){var ta=doc.getElementsByTagName("textarea")[0];if(ta){xhr.responseText=ta.value;xhr.status=
Number(ta.getAttribute("status"))||xhr.status;xhr.statusText=ta.getAttribute("statusText")||xhr.statusText}else if(scr){var pre=doc.getElementsByTagName("pre")[0];var b=doc.getElementsByTagName("body")[0];if(pre)xhr.responseText=pre.textContent?pre.textContent:pre.innerText;else if(b)xhr.responseText=b.textContent?b.textContent:b.innerText}}else if(dt==="xml"&&!xhr.responseXML&&xhr.responseText)xhr.responseXML=toXml(xhr.responseText);try{data=httpData(xhr,dt,s)}catch(err){status="parsererror";xhr.error=
errMsg=err||status}}catch(err){log("error caught: ",err);status="error";xhr.error=errMsg=err||status}if(xhr.aborted){log("upload aborted");status=null}if(xhr.status)status=xhr.status>=200&&xhr.status<300||xhr.status===304?"success":"error";if(status==="success"){if(s.success)s.success.call(s.context,data,"success",xhr);deferred.resolve(xhr.responseText,"success",xhr);if(g)$.event.trigger("ajaxSuccess",[xhr,s])}else if(status){if(typeof errMsg==="undefined")errMsg=xhr.statusText;if(s.error)s.error.call(s.context,
xhr,status,errMsg);deferred.reject(xhr,"error",errMsg);if(g)$.event.trigger("ajaxError",[xhr,s,errMsg])}if(g)$.event.trigger("ajaxComplete",[xhr,s]);if(g&&!--$.active)$.event.trigger("ajaxStop");if(s.complete)s.complete.call(s.context,xhr,status);callbackProcessed=true;if(s.timeout)clearTimeout(timeoutHandle);setTimeout(function(){if(!s.iframeTarget)$io.remove();else $io.attr("src",s.iframeSrc);xhr.responseXML=null},100)}var toXml=$.parseXML||function(s,doc){if(window.ActiveXObject){doc=new ActiveXObject("Microsoft.XMLDOM");
doc.async="false";doc.loadXML(s)}else doc=(new DOMParser).parseFromString(s,"text/xml");return doc&&doc.documentElement&&doc.documentElement.nodeName!=="parsererror"?doc:null};var parseJSON=$.parseJSON||function(s){return window["eval"]("("+s+")")};var httpData=function(xhr,type,s){var ct=xhr.getResponseHeader("content-type")||"",xml=(type==="xml"||!type)&&ct.indexOf("xml")>=0,data=xml?xhr.responseXML:xhr.responseText;if(xml&&data.documentElement.nodeName==="parsererror")if($.error)$.error("parsererror");
if(s&&s.dataFilter)data=s.dataFilter(data,type);if(typeof data==="string")if((type==="json"||!type)&&ct.indexOf("json")>=0)data=parseJSON(data);else if((type==="script"||!type)&&ct.indexOf("javascript")>=0)$.globalEval(data);return data};return deferred}};$.fn.ajaxForm=function(options,data,dataType,onSuccess){if(typeof options==="string"||options===false&&arguments.length>0){options={"url":options,"data":data,"dataType":dataType};if(typeof onSuccess==="function")options.success=onSuccess}options=
options||{};options.delegation=options.delegation&&$.isFunction($.fn.on);if(!options.delegation&&this.length===0){var o={s:this.selector,c:this.context};if(!$.isReady&&o.s){log("DOM not ready, queuing ajaxForm");$(function(){$(o.s,o.c).ajaxForm(options)});return this}log("terminating; zero elements found by selector"+($.isReady?"":" (DOM not ready)"));return this}if(options.delegation){$(document).off("submit.form-plugin",this.selector,doAjaxSubmit).off("click.form-plugin",this.selector,captureSubmittingElement).on("submit.form-plugin",
this.selector,options,doAjaxSubmit).on("click.form-plugin",this.selector,options,captureSubmittingElement);return this}return this.ajaxFormUnbind().on("submit.form-plugin",options,doAjaxSubmit).on("click.form-plugin",options,captureSubmittingElement)};function doAjaxSubmit(e){var options=e.data;if(!e.isDefaultPrevented()){e.preventDefault();$(e.target).closest("form").ajaxSubmit(options)}}function captureSubmittingElement(e){var target=e.target;var $el=$(target);if(!$el.is("[type\x3dsubmit],[type\x3dimage]")){var t=
$el.closest("[type\x3dsubmit]");if(t.length===0)return;target=t[0]}var form=target.form;form.clk=target;if(target.type==="image")if(typeof e.offsetX!=="undefined"){form.clk_x=e.offsetX;form.clk_y=e.offsetY}else if(typeof $.fn.offset==="function"){var offset=$el.offset();form.clk_x=e.pageX-offset.left;form.clk_y=e.pageY-offset.top}else{form.clk_x=e.pageX-target.offsetLeft;form.clk_y=e.pageY-target.offsetTop}setTimeout(function(){form.clk=form.clk_x=form.clk_y=null},100)}$.fn.ajaxFormUnbind=function(){return this.off("submit.form-plugin click.form-plugin")};
$.fn.formToArray=function(semantic,elements,filtering){var a=[];if(this.length===0)return a;var form=this[0];var formId=this.attr("id");var els=semantic||typeof form.elements==="undefined"?form.getElementsByTagName("*"):form.elements;var els2;if(els)els=$.makeArray(els);if(formId&&(semantic||/(Edge|Trident)\//.test(navigator.userAgent))){els2=$(':input[form\x3d"'+formId+'"]').get();if(els2.length)els=(els||[]).concat(els2)}if(!els||!els.length)return a;if($.isFunction(filtering))els=$.map(els,filtering);
var i,j,n,v,el,max,jmax;for(i=0,max=els.length;i<max;i++){el=els[i];n=el.name;if(!n||el.disabled)continue;if(semantic&&form.clk&&el.type==="image"){if(form.clk===el){a.push({name:n,value:$(el).val(),type:el.type});a.push({name:n+".x",value:form.clk_x},{name:n+".y",value:form.clk_y})}continue}v=$.fieldValue(el,true);if(v&&v.constructor===Array){if(elements)elements.push(el);for(j=0,jmax=v.length;j<jmax;j++)a.push({name:n,value:v[j]})}else if(feature.fileapi&&el.type==="file"){if(elements)elements.push(el);
var files=el.files;if(files.length)for(j=0;j<files.length;j++)a.push({name:n,value:files[j],type:el.type});else a.push({name:n,value:"",type:el.type})}else if(v!==null&&typeof v!=="undefined"){if(elements)elements.push(el);a.push({name:n,value:v,type:el.type,required:el.required})}}if(!semantic&&form.clk){var $input=$(form.clk),input=$input[0];n=input.name;if(n&&!input.disabled&&input.type==="image"){a.push({name:n,value:$input.val()});a.push({name:n+".x",value:form.clk_x},{name:n+".y",value:form.clk_y})}}return a};
$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic))};$.fn.fieldSerialize=function(successful){var a=[];this.each(function(){var n=this.name;if(!n)return;var v=$.fieldValue(this,successful);if(v&&v.constructor===Array)for(var i=0,max=v.length;i<max;i++)a.push({name:n,value:v[i]});else if(v!==null&&typeof v!=="undefined")a.push({name:this.name,value:v})});return $.param(a)};$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i];
var v=$.fieldValue(el,successful);if(v===null||typeof v==="undefined"||v.constructor===Array&&!v.length)continue;if(v.constructor===Array)$.merge(val,v);else val.push(v)}return val};$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(typeof successful==="undefined")successful=true;if(successful&&(!n||el.disabled||t==="reset"||t==="button"||(t==="checkbox"||t==="radio")&&!el.checked||(t==="submit"||t==="image")&&el.form&&el.form.clk!==el||tag==="select"&&el.selectedIndex===
-1))return null;if(tag==="select"){var index=el.selectedIndex;if(index<0)return null;var a=[],ops=el.options;var one=t==="select-one";var max=one?index+1:ops.length;for(var i=one?index:0;i<max;i++){var op=ops[i];if(op.selected&&!op.disabled){var v=op.value;if(!v)v=op.attributes&&op.attributes.value&&!op.attributes.value.specified?op.text:op.value;if(one)return v;a.push(v)}}return a}return $(el).val().replace(rCRLF,"\r\n")};$.fn.clearForm=function(includeHidden){return this.each(function(){$("input,select,textarea",
this).clearFields(includeHidden)})};$.fn.clearFields=$.fn.clearInputs=function(includeHidden){var re=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(re.test(t)||tag==="textarea")this.value="";else if(t==="checkbox"||t==="radio")this.checked=false;else if(tag==="select")this.selectedIndex=-1;else if(t==="file")if(/MSIE/.test(navigator.userAgent))$(this).replaceWith($(this).clone(true));
else $(this).val("");else if(includeHidden)if(includeHidden===true&&/hidden/.test(t)||typeof includeHidden==="string"&&$(this).is(includeHidden))this.value=""})};$.fn.resetForm=function(){return this.each(function(){var el=$(this);var tag=this.tagName.toLowerCase();switch(tag){case "input":this.checked=this.defaultChecked;case "textarea":this.value=this.defaultValue;return true;case "option":case "optgroup":var select=el.parents("select");if(select.length&&select[0].multiple)if(tag==="option")this.selected=
this.defaultSelected;else el.find("option").resetForm();else select.resetForm();return true;case "select":el.find("option").each(function(i){this.selected=this.defaultSelected;if(this.defaultSelected&&!el[0].multiple){el[0].selectedIndex=i;return false}});return true;case "label":var forEl=$(el.attr("for"));var list=el.find("input,select,textarea");if(forEl[0])list.unshift(forEl[0]);list.resetForm();return true;case "form":if(typeof this.reset==="function"||typeof this.reset==="object"&&!this.reset.nodeType)this.reset();
return true;default:el.find("form,input,label,select,textarea").resetForm();return true}})};$.fn.enable=function(b){if(typeof b==="undefined")b=true;return this.each(function(){this.disabled=!b})};$.fn.selected=function(select){if(typeof select==="undefined")select=true;return this.each(function(){var t=this.type;if(t==="checkbox"||t==="radio")this.checked=select;else if(this.tagName.toLowerCase()==="option"){var $sel=$(this).parent("select");if(select&&$sel[0]&&$sel[0].type==="select-one")$sel.find("option").selected(false);
this.selected=select}})};$.fn.ajaxSubmit.debug=false;function log(){if(!$.fn.ajaxSubmit.debug)return;var msg="[jquery.form] "+Array.prototype.join.call(arguments,"");if(window.console&&window.console.log)window.console.log(msg);else if(window.opera&&window.opera.postError)window.opera.postError(msg)}})(window.$);(function(gw){var charts={};var renderedCharts={};var chartObservers={};function initChartTypes(){var chartInitializers=gw.globals.chartInitializers||[];for(var i=0;i<chartInitializers.length;i++)chartInitializers[i](gw,charts)}charts.getSystemName=function(){return"gwCharts"};charts.init=function(isFullPageReload){if(isFullPageReload){initChartTypes();gw.globals.gwUtil.addCustomEventListener("themeChange",clearTextSizeCache);gw.globals.gwUtil.addCustomEventListener("localeChanged",charts.resize);
gw.globals.gwResizer.addResizeCallback(charts.resize)}renderAllNeededCharts()};var renderAllNeededCharts=function(){gw.globals.gwUtil.forEach(gw.globals.gwUtil.getDomNodesByAttr("data-gw-chart-should-render"),function(el){var id=el.getAttribute("data-gw-chart-id");var chartSpec=JSON.parse(el.getAttribute("data-gw-chart-spec"));el.removeAttribute("data-gw-chart-should-render");chartHandlersByType()[chartSpec.type].initSeriesVisibility(chartSpec);freshRender(id,chartSpec)})};gw.api.registerGlobalSystem(charts);
var MAX_LABEL_EM_WIDTH_HORIZONTAL=10;var MAX_LABEL_EM_WIDTH_VERTICAL=10;var MAX_LABEL_EM_WIDTH_DIAGONAL=20;var BASE_TEXT_SIZE=14;var X_AXIS_LABEL_PADDING_SIZE=16;var Y_AXIS_LABEL_PADDING_SIZE=16;var TICK_PADDING_SIZE=8;var MIN_SPACE_BETWEEN_LABELS=2;var TOOLTIP_CIRCLE_R="3px";var D3_TICK_TEXT_OFFSET_IN_EM=1.06714;var Y_AXIS_SUGGESTED_NO_TICKS=10;var Y_AXIS_MIN_LINE_HEIGHT=20;var Y_AXIS_MAX_LINE_HEIGHT=35;var AXIS_MAX_LINES=3;var ELLIPSE_STR="...";var LABEL_CLASSES="gw-ChartPanelWidget tick-mock-label";
var AXIS_CLASSES="gw-axis-label";var SIN_45=Math.sin(Math.PI/4);var LINE_CHART_TYPES=["Line","Area","XYLine","TimeSeries"];charts.STROKE_WIDTH=1;var textSizeCache={};function calculateTextSize(svg,string,className,enclosingElement){var textRoot,text,rect;if(enclosingElement){textRoot=svg.append(enclosingElement);if(textRoot)text=textRoot.append("text")}else textRoot=text=svg.append("text");if(!text)textRoot=text=svg.append("text");if(!text)return{};text.attr("class",className);text.attr("dy","-1em").text(string);
rect=text.node().getBBox();textRoot.remove();return rect}function textHeight(svg,className,enclosingElement){var cacheKey=enclosingElement?enclosingElement+"."+className:className;cacheKey=cacheKey+"_height";return textSizeCache[cacheKey]||(textSizeCache[cacheKey]=calculateTextSize(svg,"X",className,enclosingElement).height)}function textWidth(svg,className,enclosingElement,text){var cacheKey=enclosingElement?enclosingElement+"."+className:className;cacheKey=cacheKey+"_"+text+"_width";return textSizeCache[cacheKey]||
(textSizeCache[cacheKey]=calculateTextSize(svg,text,className,enclosingElement).width)}function clearTextSizeCache(){textSizeCache={}}function calculateSpacing(chart,chartSpec,chartRenderer){var xAxisLabels=chartRenderer.getXAxisTicks(chartSpec,chart);var axisLabelHeight=textHeight(chart.svg,AXIS_CLASSES);var yAxisLabelPadding=Math.round(axisLabelHeight*Y_AXIS_LABEL_PADDING_SIZE/BASE_TEXT_SIZE);var xAxisLabelPadding=Math.round(axisLabelHeight*X_AXIS_LABEL_PADDING_SIZE/BASE_TEXT_SIZE);var tickTextHeightPx=
textHeight(chart.svg,LABEL_CLASSES,"g");var textPaddingV=tickTextHeightPx*D3_TICK_TEXT_OFFSET_IN_EM;var xAxisHeight=0;var yAxisWidth=0;var dualAxisWidth=0;function leftMargin(){var margin=chartSpec.insetPadding;var useWholeNumbers=chartSpec.yaxis&&chartSpec.yaxis.useWholeNumbers;yAxisWidth=getRequiredLabelSize(charts.getTicksValues(chart.yAxisDetails,useWholeNumbers),chart.svg)+textPaddingV;margin+=yAxisWidth;if(chartSpec.yaxis.label)margin+=axisLabelHeight*chart.axisLabels.yAxisLabel.length+yAxisLabelPadding;
var xTickLeftOffset=0;var firstTick=xAxisLabels[0];if(chartSpec.xaxis.labelOrientation==="Up45")xTickLeftOffset=Math.max(chart.calculateLabelWidth(firstTick)*SIN_45,xTickLeftOffset);else if(chartSpec.xaxis.labelOrientation==="Horizontal"&&chartSpec.type!="Bar")xTickLeftOffset=Math.max(chart.calculateLabelWidth(firstTick)/2,xTickLeftOffset);return Math.max(margin,xTickLeftOffset)}function rightMargin(){var margin=chartSpec.insetPadding+textPaddingV;if(chartSpec.dualAxis&&chartSpec.dualAxis.label)margin+=
axisLabelHeight*chart.axisLabels.dualAxisLabel.length+yAxisLabelPadding;if(chartSpec.dualData){var labelSize=getRequiredLabelSize(charts.getTicksValues(chart.dualYAxisDetails,chartSpec.useWholeNumbers),chart.svg);dualAxisWidth=labelSize+textPaddingV;margin+=labelSize}var xTickRightOffset=0;var lastTick=xAxisLabels[xAxisLabels.length-1];if(chartSpec.xaxis.labelOrientation==="Down45")xTickRightOffset=Math.max(chart.calculateLabelWidth(lastTick)*SIN_45,xTickRightOffset);else if(chartSpec.xaxis.labelOrientation===
"Horizontal"&&chartSpec.type!="Bar")xTickRightOffset=Math.max(chart.calculateLabelWidth(lastTick)/2,xTickRightOffset);return Math.max(margin,xTickRightOffset)}function topMargin(){return chartSpec.insetPadding+axisLabelHeight/2}function calculateXAxisHeight(){var labelOrientation=chartSpec.xaxis.labelOrientation;var xAxisLabelMaxWidth=10;gw.globals.gwUtil.forEach(xAxisLabels,function(label){xAxisLabelMaxWidth=Math.max(chart.calculateLabelWidth(label),xAxisLabelMaxWidth)});var finalHeightPx=tickTextHeightPx+
textPaddingV/2;if(labelOrientation==="Up45"||labelOrientation==="Down45")finalHeightPx+=xAxisLabelMaxWidth*SIN_45;else if(labelOrientation==="Vertical")finalHeightPx=xAxisLabelMaxWidth+textPaddingV;return finalHeightPx}function bottomMargin(){var margin=chartSpec.insetPadding;if(chartSpec.xaxis){xAxisHeight=calculateXAxisHeight();margin+=xAxisHeight;if(chartSpec.xaxis.label)margin+=axisLabelHeight*chart.axisLabels.xAxisLabel.length+xAxisLabelPadding}return margin}return{leftMargin:leftMargin(),rightMargin:rightMargin(),
topMargin:topMargin(),bottomMargin:bottomMargin(),xAxis:{height:xAxisHeight,labels:xAxisLabels},yAxis:{width:yAxisWidth,dualAxisWidth:dualAxisWidth},xAxisLabel:{height:axisLabelHeight,padding:xAxisLabelPadding},yAxisLabel:{height:axisLabelHeight,padding:yAxisLabelPadding}}}function constructSingleAxisLegend(id,chartSpec,legendSeries,offset){var series=legendSeries||chartSpec.data.series;var $legendDiv=$("#"+id+" .gw-chart-legend");appendLegendToDOM(series,$legendDiv,offset||0,null,chartSpec.type===
"Line",chartSpec.seriesTogglingAllowed)}function constructDualAxisLegend(id,chartSpec){var $legendDivLeft=$("#"+id+" .gw-chart-legend-left");var $legendDivRight=$("#"+id+" .gw-chart-legend-right");appendLegendToDOM(chartSpec.data.series,$legendDivLeft,0,null,chartSpec.type==="Line",chartSpec.seriesTogglingAllowed);appendLegendToDOM(chartSpec.dualData.series,$legendDivRight,null,"gw-chart-series-dual",true,chartSpec.seriesTogglingAllowed)}function appendLegendToDOM(series,legendDiv,offset,seriesCssClass,
isStrokeMainColor,isSeriesTogglingAllowed){series.forEach(function(data,index){var seriesDetails=charts.seriesDetails(series);var entryClass=charts.classes("gw-chart-legend-entry",{"gw-chart-legend-entry-inactive":!data.active});var chartClass=seriesCssClass||!seriesDetails.isCustomColor(index)&&seriesDetails.getDefaultClassName(index,offset);var customColor=isStrokeMainColor?seriesDetails.getCustomStrokeColor(index):seriesDetails.getCustomFillColor(index);if(!customColor)chartClass=charts.classes(chartClass,
isStrokeMainColor?seriesDetails.getStrokeLegendClassName(index):seriesDetails.getFillLegendClassName(index));var legendEntry=$("\x3cdiv\x3e",{"class":entryClass,"data-gw-chart-series":seriesDetails.getNormalizedName(index),"data-gw-click":isSeriesTogglingAllowed?"gw.globals.gwCharts.toggleSeriesVisibility":null,"tabindex":isSeriesTogglingAllowed?0:-1});var entryContainer=$("\x3cdiv\x3e",{"class":"gw-legend-entry-container","tabindex":-1});var entryMarker=$("\x3cdiv\x3e",{"class":["gw-chart-legend-marker",
chartClass].join(" "),"style":customColor?"background-color: "+customColor:null,"data-gw-focus":"gw.globals.gwCharts.focusLegendEntryContainer","data-gw-no-tab-index":""});var entryText=$("\x3cdiv\x3e",{"class":"gw-chart-legend-text","data-gw-focus":"gw.globals.gwCharts.focusLegendEntryContainer","data-gw-no-tab-index":""});legendDiv.append(legendEntry.append(entryContainer.append(entryMarker).append(entryText.text(data.name))))})}function constructLegend(id,chartSpec,legendSeries,offset){if(!chartSpec.displayLegend)return;
if(chartSpec.dualData)constructDualAxisLegend(id,chartSpec);else constructSingleAxisLegend(id,chartSpec,legendSeries,offset)}charts.focusLegendEntryContainer=function(targetElement){var entryContainerElement=$(targetElement).closest(".gw-legend-entry-container").get(0);if(!entryContainerElement)return;if(entryContainerElement.setActive)entryContainerElement.setActive();else entryContainerElement.focus()};charts.getTooltipFormatter=function(){return d3.format(",")};charts.calculateBarStroke=function(barWidth,
barHeight,refPoint){var dashNoTop=[0,barWidth,barHeight,0,barWidth,0,barHeight,0];var dashNoBottom=[barWidth,0,barHeight,0,0,barWidth,barHeight,0];return(refPoint<0?dashNoTop:dashNoBottom).join(",")};function calculateAxisLabels(svg,chartSpec,height,width){return{xAxisLabel:chartSpec.xaxis?splitSvgTextToMatchPxSize(svg,AXIS_CLASSES,"g",chartSpec.xaxis.label,width):[],yAxisLabel:chartSpec.yaxis?splitSvgTextToMatchPxSize(svg,AXIS_CLASSES,"g",chartSpec.yaxis.label,height):[],dualAxisLabel:chartSpec.dualAxis?
splitSvgTextToMatchPxSize(svg,AXIS_CLASSES,"g",chartSpec.dualAxis.label,height):[]}}charts.Chart=function(id,chartSpec,yAxisMinMaxRange,xScaleFactory,yScaleFactory,legendSeries,offset){constructLegend(id,chartSpec,legendSeries,offset);this.svg=d3.select("#"+id+" svg");var rect=this.svg.node().getBoundingClientRect();this.yAxisDetails={minMaxRange:yAxisMinMaxRange,ticksAmount:Y_AXIS_SUGGESTED_NO_TICKS,scale:null};this.dualYAxisDetails={minMaxRange:yAxisMinMaxRange,ticksAmount:Y_AXIS_SUGGESTED_NO_TICKS,
scale:null};this.calculateLabelWidth=function(labelText){return textWidth(this.svg,LABEL_CLASSES,"g",labelText)};this.axisLabels={xAxisLabel:chartSpec.xaxis?[chartSpec.xaxis.label]:[],yAxisLabel:chartSpec.yaxis?[chartSpec.yaxis.label]:[],dualAxisLabel:chartSpec.dualAxis?[chartSpec.dualAxis.label]:[]};computeWidthAndHeight(this,chartSpec,rect);chartSpec.dualAxisSpec=getDualAxisSpec(this,chartSpec);if(this.axisLabels.xAxisLabel.length>1||this.axisLabels.yAxisLabel.length>1||this.axisLabels.dualAxisLabel.length>
1)computeWidthAndHeight(this,chartSpec,rect);if(!isRoundTypeChart(chartSpec))possiblyChangeLabelOrientationToFitLabels(chartSpec,this,rect);var hasAxes=yScaleFactory&&xScaleFactory;if(hasAxes){this.yAxisDetails.scale=yScaleFactory(this.height);this.dualYAxisDetails.scale=chartSpec.dualAxisSpec?chartSpec.dualAxisSpec.yScale:null;this.yAxisDetails.ticksAmount=this.adaptYTicksAmount(this.yAxisDetails.scale);this.dualYAxisDetails.ticksAmount=this.dualYAxisDetails.scale?this.adaptYTicksAmount(this.dualYAxisDetails.scale):
null;computeWidthAndHeight(this,chartSpec,rect);this.xAxisDetails={scale:xScaleFactory(this.width)}}this.body=this.svg.append("g").attr("transform","translate("+this.spacing.leftMargin+","+this.spacing.topMargin+")")};var isRoundTypeChart=function(chartSpec){return chartSpec.type==="Pie"||chartSpec.type==="Donut"};var computeWidthAndHeight=function(chart,chartSpec,rect){var isDonutOrPie=isRoundTypeChart(chartSpec);chart.spacing=isDonutOrPie?gw.globals.gwCharts.roundChart.calculateSpacing(rect,chartSpec):
calculateSpacing(chart,chartSpec,chartHandlersByType()[chartSpec.type]);var totalStrokeOffset=isDonutOrPie?2*gw.globals.gwCharts.STROKE_WIDTH:0;chart.width=rect.width-chart.spacing.leftMargin-chart.spacing.rightMargin-totalStrokeOffset;chart.height=rect.height-chart.spacing.topMargin-chart.spacing.bottomMargin-totalStrokeOffset;chart.axisLabels=calculateAxisLabels(chart.svg,chartSpec,chart.height,chart.width)};var possiblyEllipsify=function(str,maxLength){if(str.length<=maxLength)return str.slice(0);
return str.slice(0,maxLength-ELLIPSE_STR.length)+ELLIPSE_STR};function trimTextToMatchPxSize(chart,text,pxSize){if(chart.calculateLabelWidth(text)<=pxSize)return text;var minimal=text.length>3?text.substring(0,3)+ELLIPSE_STR:text;if(chart.calculateLabelWidth(minimal)>pxSize)return minimal;var trimmed=text.substring(0,text.length-1-ELLIPSE_STR.length);var candidate=trimmed+ELLIPSE_STR;while(chart.calculateLabelWidth(candidate)>pxSize){trimmed=trimmed.substring(0,trimmed.length-1);candidate=trimmed+
ELLIPSE_STR}return candidate}function splitLongLabel(words,svg,className,enclosingElement,pxSize){var resultChunks=[];var currentText="";var index=0;while(index<words.length&&resultChunks.length<=AXIS_MAX_LINES)if(textWidth(svg,className,enclosingElement,currentText+words[index])<pxSize){currentText+=words[index]+" ";index++}else{if(currentText.length===0){var letterCount=pxSize/textWidth(svg,className,enclosingElement,words[index])*words[index].length;currentText=words[index].substr(0,letterCount);
words[index]=words[index].substr(letterCount,words[index].length-letterCount)}resultChunks.push(currentText);currentText=""}if(currentText.length>0)resultChunks.push(currentText);return resultChunks}function splitSvgTextToMatchPxSize(svg,className,enclosingElement,text,pxSize){var totalTextWidth=textWidth(svg,className,enclosingElement,text);if(totalTextWidth>pxSize)return splitLongLabel(text.split(" "),svg,className,enclosingElement,pxSize);return[text]}var getRequiredLabelSize=function(labels,svg){var maxLabelLength=
labels.map(function(category){return textWidth(svg,LABEL_CLASSES,"g",category)}).reduce(function(a,b){return Math.max(a,b)},0);return Math.min(MAX_LABEL_EM_WIDTH_HORIZONTAL*textHeight(svg,LABEL_CLASSES,"g"),maxLabelLength)};function isLineChart(chartType){return LINE_CHART_TYPES.indexOf(chartType)>=0}var possiblyChangeLabelOrientationToFitLabels=function(chartSpec,chart,rect){if(chartSpec.xaxis.labelOrientation&&chartSpec.xaxis.labelOrientation!=="Horizontal")return;var labels=chartSpec.data.categories||
chart.spacing.xAxis.labels;var spaceForLabel=getRequiredLabelSize(labels,chart.svg,false)+MIN_SPACE_BETWEEN_LABELS;var labelsFitAxis=chart.width/labels.length>spaceForLabel;var firstLabelFits=!isLineChart(chartSpec.type)||chart.calculateLabelWidth(labels[0])/2<chart.spacing.leftMargin;var lastLabelFits=!isLineChart(chartSpec.type)||chart.calculateLabelWidth(labels[labels.length-1])/2<chart.spacing.rightMargin;var dynamicLabelOrientation=labelsFitAxis&&lastLabelFits&&firstLabelFits?"Horizontal":"Up45";
if(dynamicLabelOrientation!==chartSpec.xaxis.labelOrientation){chartSpec.xaxis.labelOrientation=dynamicLabelOrientation;computeWidthAndHeight(chart,chartSpec,rect);chartSpec.dualAxisSpec=getDualAxisSpec(chart,chartSpec)}};function setDefaultNumberFormat(){d3.formatDefaultLocale({"decimal":gw.globals.gwLocale.getDecimalSymbol(),"thousands":gw.globals.gwLocale.getThousandsSymbol(),"grouping":[3],"currency":["$",""]})}charts.Chart.prototype.appendLabelChunk=function(axisLabels,chunk,index){var labelChunk=
axisLabels.append("tspan").attr("x","0").text(chunk);if(index>0)labelChunk.attr("dy",textHeight(this.svg,AXIS_CLASSES,"g"))};charts.Chart.prototype.renderHorizontalAxes=function(chartSpec,scale){var axisSpec=chartSpec.xaxis;var axisGen=d3.axisBottom(scale).tickSizeOuter(0).tickPadding(TICK_PADDING_SIZE);if(axisSpec.dateFormat)axisGen.tickFormat(function(d){return gw.globals.gwCharts.timeSeriesChart.dateFormatter(axisSpec.dateFormat,d)});else if(axisSpec.useWholeNumbers&&!chartSpec.data.categories)axisGen.tickFormat(charts.formatWholeNumberTick);
var labelOrientation=axisSpec.labelOrientation;var xAxis=this.body.append("g").attr("transform","translate(0,"+this.height+")").attr("class","gw-axis gw-x-axis").call(axisGen);var isCategoryData=!!chartSpec.data.categories;var chart=this;if(isCategoryData)var maxLabelWidth=getMaxLabelWidth(labelOrientation);var modXLabels=function(d,index){var self=d3.select(d);var textHeightPx=textHeight(d.ownerSVGElement,LABEL_CLASSES,"g");var currentText=self.text();if(isCategoryData)self.text(charts.formatTickLabel(currentText,
chartSpec.xaxis.labelOrientation,chartSpec.data.categories.length,maxLabelWidth,chart,chartSpec.type,index));switch(labelOrientation){case "Vertical":self.attr("transform","rotate(90) translate("+textHeightPx+", -"+1.25*textHeightPx+")").style("text-anchor","start").classed("vertical-labels",true);break;case "Down45":self.attr("transform","rotate(45) translate("+.5*textHeightPx+", -"+.25*textHeightPx+")").style("text-anchor","start").classed("flip-45-labels",true);break;case "Up45":self.attr("transform",
"rotate(315) translate(-"+.5*textHeightPx+", -"+.25*textHeightPx+")").style("text-anchor","end").classed("flip-45-labels",true);break;default:self.style("text-anchor","middle").classed("horizontal-labels",true)}self.attr("data-gw-tooltip",currentText)};xAxis.selectAll(".tick").selectAll("text").nodes().forEach(modXLabels);if(axisSpec.label){var axisLabel=this.body.append("text").attr("transform","translate("+this.width/2+" ,"+(this.height+this.spacing.xAxis.height+this.spacing.xAxisLabel.padding)+
")").style("text-anchor","middle").attr("dy","1em").attr("class",AXIS_CLASSES+" gw-x-axis");chart.axisLabels.xAxisLabel.forEach(function(chunk,index){chart.appendLabelChunk(axisLabel,chunk,index)})}};charts.Chart.prototype.renderYAxis=function(axisSpec){var axisNode=this.body.append("g").attr("class","gw-axis gw-y-axis");var axisGen=d3.axisLeft(this.yAxisDetails.scale).ticks(this.yAxisDetails.ticksAmount).tickPadding(TICK_PADDING_SIZE);if(axisSpec.useWholeNumbers)axisGen.tickFormat(charts.formatWholeNumberTick);
axisNode.call(axisGen);if(axisSpec.label)this.renderYAxisLabel()};charts.Chart.prototype.renderYAxisLabel=function(){var textChunks=this.axisLabels.yAxisLabel;var axisLabels=this.body.append("text").attr("transform","rotate(-90) translate("+-(this.height/2)+","+-(this.spacing.yAxis.width+this.spacing.yAxisLabel.padding+this.spacing.yAxisLabel.height*(textChunks.length-1))+")").style("text-anchor","middle").attr("class","gw-axisLabels-label gw-y-axisLabels");var chart=this;textChunks.forEach(function(chunk,
index){chart.appendLabelChunk(axisLabels,chunk,index)})};charts.Chart.prototype.renderDualYAxis=function(axisSpec){var axisNode=this.body.append("g").attr("class","gw-axis gw-secondary-y-axis").attr("transform","translate( "+this.width+", 0 )");var axisGen=d3.axisRight(this.dualYAxisDetails.scale).ticks(this.dualYAxisDetails.ticksAmount).tickPadding(TICK_PADDING_SIZE);if(axisSpec.useWholeNumbers)axisGen.tickFormat(charts.formatWholeNumberTick);axisNode.call(axisGen);if(axisSpec.label)this.renderDualYAxisLabel()};
charts.Chart.prototype.renderDualYAxisLabel=function(){var axisLabels=this.body.append("text").attr("transform","rotate(-90) translate("+-(this.height/2)+","+(this.width+this.spacing.yAxis.dualAxisWidth+MAX_LABEL_EM_WIDTH_VERTICAL+this.spacing.yAxisLabel.padding)+")").style("text-anchor","middle").attr("class","gw-axis-label gw-secondary-y-axis");var chart=this;chart.axisLabels.dualAxisLabel.forEach(function(chunk,index){chart.appendLabelChunk(axisLabels,chunk,index)})};charts.Chart.prototype.renderHorizontalGrid=
function(){var gridAxis=this.body.append("g").attr("class","gw-y-grid");var gridGen=d3.axisLeft(this.yAxisDetails.scale).ticks(this.yAxisDetails.ticksAmount).tickSize(-this.width).tickFormat("");gridAxis.call(gridGen)};charts.formatWholeNumberTick=function(num){return Math.floor(num)===num?num:""};charts.Chart.prototype.renderVerticalAxes=function(chartSpec){this.renderYAxis(chartSpec.yaxis);if(chartSpec.dualAxisSpec)this.renderDualYAxis(chartSpec.dualAxis);this.renderHorizontalGrid()};charts.Chart.prototype.adaptYTicksAmount=
function(scale){var initialTicks=scale.ticks();var lineHeight=Math.floor(this.height/initialTicks.length);var suggestedTicksDetails={ticksAmount:initialTicks.length,startingValueMatches:true,endingValueMatches:true};var needsIncrease=lineHeight>Y_AXIS_MAX_LINE_HEIGHT;var needsDecrease=lineHeight<Y_AXIS_MIN_LINE_HEIGHT;if(needsIncrease||needsDecrease){var lookupFactor=needsIncrease?Y_AXIS_MAX_LINE_HEIGHT:Y_AXIS_MIN_LINE_HEIGHT;var lookupDirection=needsIncrease?1:-1;var suggestedTicksAmount=Math.floor(this.height/
lookupFactor);var suggestedTicks=scale.ticks(suggestedTicksAmount);suggestedTicksDetails={ticksAmount:suggestedTicks.length,startingValueMatches:initialTicks[0]===suggestedTicks[0],endingValueMatches:initialTicks[initialTicks.length-1]===suggestedTicks[suggestedTicks.length-1]};if(!suggestedTicksDetails.startingValueMatches||!suggestedTicksDetails.endingValueMatches)suggestedTicksDetails=findAppropriateTicksAmount(scale,suggestedTicksAmount,lookupDirection);if(!suggestedTicksDetails.startingValueMatches||
!suggestedTicksDetails.endingValueMatches)suggestedTicksDetails=findAppropriateTicksAmount(scale,suggestedTicksAmount,-1*lookupDirection)}var useAdaptedValue=suggestedTicksDetails.ticksAmount!==Y_AXIS_SUGGESTED_NO_TICKS&&suggestedTicksDetails.startingValueMatches&&suggestedTicksDetails.endingValueMatches;return useAdaptedValue?suggestedTicksDetails.ticksAmount:Y_AXIS_SUGGESTED_NO_TICKS};function findAppropriateTicksAmount(scale,suggestedAmount,transitionFactor){var initialTicks=scale.ticks();var startingValue=
initialTicks[0];var endingValue=initialTicks[initialTicks.length-1];var ticksAmount=suggestedAmount;var newTicks=scale.ticks(ticksAmount);var startingValueMatches=startingValue===newTicks[0];var endingValueMatches=endingValue===newTicks[newTicks.length-1];function isReasonableAmount(amount){if(transitionFactor>0)return amount<initialTicks.length;else return amount>1}while((!startingValueMatches||!endingValueMatches)&&isReasonableAmount(ticksAmount)){ticksAmount+=transitionFactor;newTicks=scale.ticks(ticksAmount);
startingValueMatches=startingValue===newTicks[0];endingValueMatches=endingValue===newTicks[newTicks.length-1]}return{ticksAmount:ticksAmount,startingValueMatches:startingValueMatches,endingValueMatches:endingValueMatches}}charts.seriesDetails=function(series){function strokeClassName(i){return series[i].stroke&&series[i].stroke.className||""}function fillClassName(i){return series[i].fill&&series[i].fill.className||""}return{getClassNames:function(serialIndex,offset){return this.isCustomColor(serialIndex)?
charts.classes(strokeClassName(serialIndex),fillClassName(serialIndex)):this.getDefaultClassName(serialIndex,offset)},getDefaultClassName:function(serialIndex,offset){var index=serialIndex+1+(offset?offset:0);return"gw-chartcolor-"+index},getFillLegendClassName:function(serialIndex){return series[serialIndex].fill&&series[serialIndex].fill.legendClassName||""},getStrokeLegendClassName:function(serialIndex){return series[serialIndex].stroke&&series[serialIndex].stroke.legendClassName||""},getCustomFillColor:function(serialIndex){return this.isCustomColor(serialIndex)?
series[serialIndex].fill&&series[serialIndex].fill.hexColor:""},getCustomStrokeColor:function(serialIndex){return this.isCustomColor(serialIndex)?series[serialIndex].stroke&&series[serialIndex].stroke.hexColor:""},isCustomColor:function(serialIndex){return series&&series[serialIndex]&&series[serialIndex].colorSet},getNormalizedName:function(serialIndex){return normalizeSeriesName(series[serialIndex])}}};function normalizeSeriesName(seriesDetails){if(!seriesDetails.name)return"";var escapedName=seriesDetails.name.replace(" ",
"%20;").replace("'","%22;").replace('"',"%22;").replace("\x26","%26;").replace("\x3c","%3C;").replace("\x3e","%3E;");return escapedName+(seriesDetails.id?"-"+seriesDetails.id:"")}charts.redrawCharts=function(){Object.keys(renderedCharts).forEach(function(id){var chartSpec=renderedCharts[id];if(chartSpec!=null&&chartSpec.type)freshRender(id,chartSpec)})};charts.resize=function(){gw.globals.gwCharts.redrawCharts()};function freshRender(id,chartSpec){var chartNode=gw.globals.gwUtil.getDomNode("#"+id);
gw.globals.gwCharts.cleanup(chartNode,chartSpec);setDefaultNumberFormat();getRenderer(id,chartSpec).render();renderedCharts[id]=chartSpec;registerChartExistenceObserver(id)}function registerChartExistenceObserver(id){if(chartObservers[id])return;var observer=new MutationObserver(function(){if(!document.getElementById(id)){delete renderedCharts[id];delete chartObservers[id];this.disconnect()}});observer.observe(gw.globals.gwUtil.getDomNode(document.body),{childList:true,subtree:true});chartObservers[id]=
observer}var getDualAxisSpec=function(chart,chartSpec){if(chartSpec.dualData){var dualYScale=d3.scaleLinear().domain(dualAxisMinMaxRange(chartSpec)).range([chart.height,0]);return{chartType:chartSpec.dualType,yScale:dualYScale,data:chartSpec.dualData}}return null};charts.seriesMinMaxDataPointRange=function(data,dataPointValueAccessor){var dataPointIdxValues=data.reduce(function(acc,series){return acc.concat(series.reduce(function(acc2,dataPoint){return acc2.concat(dataPointValueAccessor(dataPoint))},
[]))},[]);return[d3.min(dataPointIdxValues),d3.max(dataPointIdxValues)]};charts.categoryDataMinMaxYRange=function(data){var minY=d3.min(data.valuesPerCategory,function(arr){return d3.min(arr)});var maxY=d3.max(data.valuesPerCategory,function(arr){return d3.max(arr)});return[minY,maxY]};charts.stackedDataMinMaxYRange=function(data){if(data.length===0)return[0,0];var minY=d3.min(data.map(function(d){return d3.min(d,function(arr){return arr[0]})}));var maxY=d3.max(data.map(function(d){return d3.max(d,
function(arr){return arr[1]})}));return[minY,maxY]};charts.axisRange=function(axisSpec,minMaxRange){var lowerBound=gw.globals.gwUtil.hasValue(axisSpec.lowerBound)?Math.min(axisSpec.lowerBound,minMaxRange[0]):minMaxRange[0];var upperBound=gw.globals.gwUtil.hasValue(axisSpec.upperBound)?Math.max(axisSpec.upperBound,minMaxRange[1]):minMaxRange[1];return[lowerBound,upperBound]};function dualAxisMinMaxRange(chartSpec){return gw.globals.gwCharts.axisRange(chartSpec.dualAxis,chartSpec.dualData.valuesPerCategory?
gw.globals.gwCharts.categoryDataMinMaxYRange(chartSpec.dualData):gw.globals.gwCharts.seriesMinMaxDataPointRange(chartSpec.dualData.seriesValues,function(d){return d.y}))}charts.getNumericalAxisScale=function(axisSpec,domain,chartSize,isXAxis){var range=isXAxis?[0,chartSize]:[chartSize,0];return d3.scaleLinear().domain(domain).range(range).nice()};charts.getTicksValues=function(axisDetails,useWholeNumbers){var ticks=axisDetails.scale?axisDetails.scale.ticks(axisDetails.ticksAmount):d3.ticks(axisDetails.minMaxRange[0],
axisDetails.minMaxRange[1],axisDetails.ticksAmount);if(useWholeNumbers)return ticks.map(function(tick){return charts.formatWholeNumberTick(tick)});var format=d3.formatSpecifier(",f");format.precision=d3.precisionFixed(ticks[1]-ticks[0]);var formatter=d3.format(format);return ticks.map(function(tick){return formatter(tick)})};charts.noDataGridChart=function(chart,message){chart.body.selectAll(".gw-chart-placeholder").remove();chart.body.selectAll(".gw-y-grid").append("g").attr("class","gw-chart-placeholder").append("text").attr("x",
chart.width/2).attr("y",chart.height/2).attr("text-anchor","middle").text(message)};charts.renderToolTips=function(chart,spec,className,tooltipProvider,xValueProvider,yValueProvider,data,xOffset,seriesKeys,ignoreColorPalette){var tooltipsClassName=className+"-tooltips";var seriesDetails=charts.seriesDetails(spec.data.series);seriesKeys.forEach(function(i){chart.body.selectAll("g."+tooltipsClassName+"[data-gw-chart-series\x3d'"+seriesDetails.getNormalizedName(i)+"']").remove()});chart.body.selectAll("g."+
tooltipsClassName).data(data).enter().append("g").attr("data-gw-chart-series",function(d,i){return seriesDetails.getNormalizedName(seriesKeys[i])}).attr("data-gw-dblclick","gw.globals.gwCharts.toggleOneActiveSeries").attr("data-gw-refuse-focus",true).attr("transform",function(d,i){return"translate("+xOffset+", 0)"}).attr("class",tooltipsClassName).each(function(seriesData,seriesIndex){var seriesOffset=seriesKeys?seriesKeys[seriesIndex]:seriesIndex;var seriesName=spec.data.series[seriesOffset].name;
d3.select(this).selectAll("circle.gw-chart-tooltip-circle").data(seriesData).enter().append("circle").attr("cx",xValueProvider).attr("cy",yValueProvider).attr("class",function(){return charts.classes("gw-chart-tooltip-circle",!ignoreColorPalette&&seriesDetails.getClassNames(seriesOffset))}).attr("stroke",function(){return seriesDetails.getCustomStrokeColor(seriesOffset)}).attr("stroke-width",gw.globals.gwCharts.STROKE_WIDTH).attr("fill",function(){return seriesDetails.getCustomFillColor(seriesOffset)}).attr("data-gw-tooltip",
function(d){return tooltipProvider(d,seriesName)}).attr("r",TOOLTIP_CIRCLE_R)})};charts.renderSecondAxisLine=function(chart,spec,dualAxisSpec,xValueProvider,yValueProvider,tooltipProvider,options){var keys=gw.globals.gwCharts.getActiveSeriesKeys(dualAxisSpec.data.series);var dualAxisData=options&&options.transposeData?d3.transpose(dualAxisSpec.data.valuesPerCategory):dualAxisSpec.data.seriesValues;dualAxisData=dualAxisData.filter(function(serialValues,id){return keys.indexOf(id)>=0});var offsetData=
options&&options.xOffset?{seriesCount:spec.data.series.length,xOffset:options.xOffset}:{seriesCount:spec.data.series.length};gw.globals.gwCharts.lineChart.renderLine(chart,dualAxisSpec,"gw-chart-series-dual",tooltipProvider,xValueProvider,yValueProvider,dualAxisData,keys,offsetData,true)};charts.toggleSeriesVisibility=function(eventNode){toggleSeriesVisibility(eventNode,false)};charts.toggleOneActiveSeries=function(eventNode){toggleSeriesVisibility(eventNode,true)};function toggleSeriesVisibility(eventNode,
leaveOnlyOneActive){var $parentWidgetNode=$(eventNode).closest("div[class*\x3dChartPanelWidget]");var chartId=$parentWidgetNode.attr("id");var chartSpec=renderedCharts[chartId];if(!chartSpec.seriesTogglingAllowed)return;var renderer=getRenderer(chartId,chartSpec);var seriesTogglingMethod=leaveOnlyOneActive?"toggleOneActiveSeries":"toggleSeriesVisibility";var selectedSeriesName=$(eventNode).data().gwChartSeries;gw.globals.gwTooltips.hide();renderer[seriesTogglingMethod](chartSpec,selectedSeriesName,
$parentWidgetNode[0]);renderer.render()}charts.cleanup=function(chartNode,chartSpec){chartSpec.renderer=null;var svgNode=gw.globals.gwUtil.getDomNode("svg",chartNode);var legendEntries=gw.globals.gwUtil.getDomNodes(".gw-chart-legend-entry",chartNode);for(var i=legendEntries.length-1;i>=0;i--)legendEntries[i].parentElement.removeChild(legendEntries[i]);gw.globals.gwUtil.removeNodeIfExists("g",svgNode);gw.globals.gwUtil.removeNodeIfExists("script",chartNode)};charts.getActiveSeriesKeys=function(seriesData){var keys=
[];seriesData.forEach(function(data,index){if(data.active)keys.push(index)});return keys};charts.initSeriesVisibilityForRoundChart=function(chartSpec){chartSpec.data.categoriesVisibility=[];chartSpec.data.categories.forEach(function(){chartSpec.data.categoriesVisibility.push(true)})};charts.initSeriesVisibilityForAxisChart=function(chartSpec){getAllAvailableSeriesFromSpec(chartSpec).forEach(function(details,index){details.id=index;details.active=true})};charts.toggleSeriesVisibilityForRoundChart=
function(chartSpec,selectedSeriesName,parentWidgetNode){var categories=chartSpec.data.categories;for(var i=0;i<categories.length;i++)if(normalizeSeriesName({name:categories[i]})===selectedSeriesName){chartSpec.data.categoriesVisibility[i]=!chartSpec.data.categoriesVisibility[i];var allLegendEntriesDisabled=chartSpec.data.categoriesVisibility.every(function(isActive){return!isActive});if(allLegendEntriesDisabled){chartSpec.data.categoriesVisibility[i]=!chartSpec.data.categoriesVisibility[i];return}}toggleLegendEntry(parentWidgetNode,
selectedSeriesName)};charts.toggleSeriesVisibilityForAxisChart=function(chartSpec,selectedSeriesName,parentWidgetNode){var allAvailableSeries=getAllAvailableSeriesFromSpec(chartSpec);for(var i=0;i<allAvailableSeries.length;i++){var entry=allAvailableSeries[i];if(normalizeSeriesName(entry)===selectedSeriesName){entry.active=!entry.active;break}}toggleLegendEntry(parentWidgetNode,selectedSeriesName)};charts.toggleOneActiveSeriesForAxisChart=function(chartSpec,selectedSeriesName,parentWidgetNode){var numberOfActiveSeries=
getAllAvailableSeriesFromSpec(chartSpec).filter(function(data){return data.active}).length;if(numberOfActiveSeries>1)getAllAvailableSeriesFromSpec(chartSpec).filter(function(data){return normalizeSeriesName(data)!==selectedSeriesName}).forEach(function(data){data.active=false;switchOffLegendEntry(parentWidgetNode,normalizeSeriesName(data))});else getAllAvailableSeriesFromSpec(chartSpec).forEach(function(data){data.active=true;switchOnLegendEntry(parentWidgetNode,normalizeSeriesName(data))})};charts.toggleOneActiveSeriesForRoundChart=
function(chartSpec,selectedSeriesName,parentWidgetNode){};charts.formatTickLabel=function(labelText,labelOrientation,noTicks,maxLabelWidth,chart,chartType,tickIndex){var labelSpacing=MIN_SPACE_BETWEEN_LABELS*(noTicks+1);if(labelOrientation==="Horizontal"){var maxLabelWidthPx=Math.floor((chart.width-labelSpacing)/noTicks);if(isLineChart(chartType)){if(tickIndex==0){var pxSize=chart.spacing?Math.min(maxLabelWidthPx,chart.spacing.leftMargin*2):maxLabelWidthPx;return trimTextToMatchPxSize(chart,labelText,
pxSize)}if(tickIndex==noTicks-1){var pxSize=chart.spacing?Math.min(maxLabelWidthPx,chart.spacing.rightMargin*2):maxLabelWidthPx;return trimTextToMatchPxSize(chart,labelText,pxSize)}}return trimTextToMatchPxSize(chart,labelText,maxLabelWidthPx)}else return possiblyEllipsify(labelText,maxLabelWidth)};charts.createXAxisLabels=function(chartSpec,chart){var maxLabelWidth=getMaxLabelWidth(chartSpec.xaxis.labelOrientation);var xAxisLabels=[];gw.globals.gwUtil.forEach(chartSpec.data.categories,function(currentText,
i){var labelChunks=charts.formatTickLabel(currentText,chartSpec.xaxis.labelOrientation,chartSpec.data.categories.length,maxLabelWidth,chart,chartSpec.type,i);xAxisLabels.push(labelChunks)});return xAxisLabels};charts.classes=function(){var classes=[];for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(!arg)continue;var argType=typeof arg;if(argType==="string"||argType==="number")classes.push(arg);else if(Array.isArray(arg)&&arg.length){var inner=charts.classes.apply(null,arg);if(inner)classes.push(inner)}else if(argType===
"object")for(var key in arg)if({}.hasOwnProperty.call(arg,key)&&arg[key])classes.push(key)}return classes.join(" ")};function getMaxLabelWidth(labelOrientation){if(labelOrientation==="Up45"||labelOrientation==="Down45")return MAX_LABEL_EM_WIDTH_DIAGONAL;else if(labelOrientation==="Vertical")return MAX_LABEL_EM_WIDTH_VERTICAL;else return MAX_LABEL_EM_WIDTH_HORIZONTAL}function getRenderer(id,chartSpec){var withAxes=false;var chartHandler=chartHandlersByType()[chartSpec.type];if(!chartSpec.renderer){withAxes=
true;chartSpec.renderer=chartHandler.getRenderer(id,chartSpec)}return{render:function(){chartSpec.renderer.render(withAxes);gw.globals.gwEvents.addInlineEventListenersToContainer(gw.globals.gwUtil.getDomNode("#"+id))},toggleSeriesVisibility:chartHandler.toggleSeriesVisibility,toggleOneActiveSeries:chartHandler.toggleOneActiveSeries}}function getAllAvailableSeriesFromSpec(chartSpec){return chartSpec.dualData?[].concat(chartSpec.data.series).concat(chartSpec.dualData.series):chartSpec.data.series}function toggleLegendEntry(parentWidgetNode,
seriesName){gw.globals.gwUtil.toggleClass(getLegendEntryNode(parentWidgetNode,seriesName),"gw-chart-legend-entry-inactive")}function switchOnLegendEntry(parentWidgetNode,seriesName){gw.globals.gwUtil.removeClass(getLegendEntryNode(parentWidgetNode,seriesName),"gw-chart-legend-entry-inactive")}function switchOffLegendEntry(parentWidgetNode,seriesName){gw.globals.gwUtil.addClass(getLegendEntryNode(parentWidgetNode,seriesName),"gw-chart-legend-entry-inactive")}function getLegendEntryNode(parentWidgetNode,
seriesName){return parentWidgetNode.querySelector("div[data-gw-chart-series\x3d'"+seriesName+"']")}var chartHandlersByType=function(){return{"Area":gw.globals.gwCharts.areaChart,"Bar":gw.globals.gwCharts.barChart,"Donut":gw.globals.gwCharts.donutChart,"Line":gw.globals.gwCharts.lineChart,"Pie":gw.globals.gwCharts.pieChart,"XYLine":gw.globals.gwCharts.xylineChart,"StackedBar":gw.globals.gwCharts.stackedBarChart,"TimeSeries":gw.globals.gwCharts.timeSeriesChart}}})(gw);gw.globals.chartInitializers=gw.globals.chartInitializers||[];
gw.globals.chartInitializers.push(function(gw,gwCharts){var areaChart=gwCharts.areaChart={};areaChart.initSeriesVisibility=gwCharts.initSeriesVisibilityForAxisChart;areaChart.toggleOneActiveSeries=gwCharts.toggleOneActiveSeriesForAxisChart;areaChart.toggleSeriesVisibility=gwCharts.toggleSeriesVisibilityForAxisChart;areaChart.getXAxisTicks=gwCharts.createXAxisLabels;areaChart.getRenderer=function(id,spec){var className="gw-chart-series";var seriesCount=spec.data.series.length;var stack=d3.stack().offset(d3.stackOffsetDiverging).keys(d3.range(0,
seriesCount));var stackedData=stack(spec.data.valuesPerCategory);var yAxisMinMaxRange=gwCharts.axisRange(spec.yaxis,gwCharts.stackedDataMinMaxYRange(stackedData));var categories=spec.data.categories;var xScaleFactory=function(chartWidth){return d3.scalePoint().domain(categories).range([0,chartWidth])};var yScaleFactory=function(chartHeight){return gwCharts.getNumericalAxisScale(spec.yaxis,yAxisMinMaxRange,chartHeight)};var chart=new gwCharts.Chart(id,spec,yAxisMinMaxRange,xScaleFactory,yScaleFactory);
var tooltipProvider=function(d,seriesName){return seriesName+": "+gwCharts.getTooltipFormatter()(Math.abs(d[0])<Math.abs(d[1])?d[1]:d[0])};var xValueProvider=function(d,i){return chart.xAxisDetails.scale(categories[i])};var yValueProvider=function(d){return chart.yAxisDetails.scale(Math.abs(d[0])<Math.abs(d[1])?d[1]:d[0])};var area=d3.area().x(xValueProvider).y0(function(d){return chart.yAxisDetails.scale(d[0])}).y1(function(d){return chart.yAxisDetails.scale(d[1])});var stroke=d3.line().x(xValueProvider).y(yValueProvider);
return{render:function(withAxes){var keys=gwCharts.getActiveSeriesKeys(spec.data.series);var data=d3.stack().offset(d3.stackOffsetDiverging).keys(keys)(spec.data.valuesPerCategory);var seriesDetails=gwCharts.seriesDetails(spec.data.series);if(withAxes)chart.renderVerticalAxes(spec);chart.body.selectAll("g[data-gw-chart-series]").remove();var seriesGroup=chart.body.selectAll("g."+className).data(data).enter().append("g").attr("class",className).attr("data-gw-chart-series",function(d,i){return seriesDetails.getNormalizedName(keys[i])}).attr("data-gw-dblclick",
"gwCharts.toggleOneActiveSeries");seriesGroup.append("path").attr("class",function(d,i){return gwCharts.classes(seriesDetails.getClassNames(keys[i]),className)}).attr("fill",function(d,i){return seriesDetails.getCustomFillColor(keys[i])}).attr("stroke",function(d,i){return seriesDetails.getCustomStrokeColor(keys[i])}).attr("d",area);seriesGroup.append("path").style("fill","none").attr("stroke",function(d,i){return seriesDetails.getCustomStrokeColor(keys[i])}).attr("class",function(d,i){return seriesDetails.getClassNames(keys[i])}).attr("d",
stroke);gwCharts.renderToolTips(chart,spec,className,tooltipProvider,xValueProvider,yValueProvider,data,0,keys);if(spec.dualAxisSpec){var dualYValueProvider=function(d){return spec.dualAxisSpec.yScale(d)};var dualAxisTooltipProvider=function(d,seriesName){return seriesName+": "+gwCharts.getTooltipFormatter()(d)};gwCharts.renderSecondAxisLine(chart,spec,spec.dualAxisSpec,xValueProvider,dualYValueProvider,dualAxisTooltipProvider,{transposeData:true})}if(spec.noData)gwCharts.noDataGridChart(chart,spec.noData);
if(withAxes)chart.renderHorizontalAxes(spec,chart.xAxisDetails.scale)}}}});gw.globals.chartInitializers=gw.globals.chartInitializers||[];
gw.globals.chartInitializers.push(function(gw,gwCharts){var barChart=gwCharts.barChart={};var MAX_BAR_WIDTH=64;var BARS_INNER_PADDING=1;barChart.initSeriesVisibility=gwCharts.initSeriesVisibilityForAxisChart;barChart.toggleOneActiveSeries=gwCharts.toggleOneActiveSeriesForAxisChart;barChart.toggleSeriesVisibility=gwCharts.toggleSeriesVisibilityForAxisChart;barChart.getXAxisTicks=gwCharts.createXAxisLabels;barChart.getRenderer=function(id,spec){var minMaxRange=gwCharts.categoryDataMinMaxYRange(spec.data);
var yAxisMinMaxRange=gwCharts.axisRange(spec.yaxis,[Math.min(minMaxRange[0],0),minMaxRange[1]]);var yScaleFactory=function(chartHeight){return gwCharts.getNumericalAxisScale(spec.yaxis,yAxisMinMaxRange,chartHeight)};var xScaleFactory=function(chartWidth){return d3.scaleBand().padding(.2).domain(spec.data.categories).range([0,chartWidth])};var chart=new gwCharts.Chart(id,spec,yAxisMinMaxRange,xScaleFactory,yScaleFactory);var seriesDetails=gwCharts.seriesDetails(spec.data.series);var dualAxisSeriesCount=
spec.dualAxisSpec?spec.dualAxisSpec.data.series.length:0;return{render:function(withAxes){var keys=gwCharts.getActiveSeriesKeys(spec.data.series);var data=d3.transpose(spec.data.valuesPerCategory).filter(function(serialValues,id){return keys.indexOf(id)>=0});var xBandScale=d3.scaleBand().domain(d3.range(0,dualAxisSeriesCount+data.length)).range([0,chart.xAxisDetails.scale.bandwidth()]).paddingInner(BARS_INNER_PADDING/chart.xAxisDetails.scale.bandwidth());if(withAxes)chart.renderVerticalAxes(spec);
chart.body.selectAll("g[data-gw-chart-series]").remove();chart.body.selectAll("g.gw-chart-series").data(data).enter().append("g").attr("data-gw-chart-series",function(d,i){return seriesDetails.getNormalizedName(keys[i])}).attr("data-gw-dblclick","gwCharts.toggleOneActiveSeries").attr("class",function(d,i){return gwCharts.classes(seriesDetails.getClassNames(keys[i]),"gw-chart-series")}).attr("fill",function(d,i){return seriesDetails.getCustomFillColor(keys[i])}).attr("stroke",function(d,i){return seriesDetails.getCustomStrokeColor(keys[i])}).attr("transform",
function(d,i){return"translate("+xBandScale(i)+", 0)"}).each(function(seriesData,seriesIndex){var seriesOffset=keys[seriesIndex];var seriesName=spec.data.series[seriesOffset].name;var scaleBandwidth=xBandScale.bandwidth();var barWidth=barChart.getBarWidth(scaleBandwidth);var barHeightProvider=function(d){return Math.abs(chart.yAxisDetails.scale(d)-chart.yAxisDetails.scale(0))};d3.select(this).selectAll("rect.gw-chart-bar").data(seriesData).enter().append("rect").attr("class","gw-chart-bar").attr("x",
function(d,i){var xOffset=getXOffset(scaleBandwidth,barWidth,seriesIndex,keys.length);return chart.xAxisDetails.scale(spec.data.categories[i])+xOffset}).attr("y",function(d){var yPosition=chart.yAxisDetails.scale(Math.max(0,d));return d<0?yPosition+1:yPosition}).attr("data-gw-tooltip",function(d){return seriesName+": "+gwCharts.getTooltipFormatter()(d)}).attr("width",barWidth).attr("height",function(d){return Math.abs(chart.yAxisDetails.scale(d)-chart.yAxisDetails.scale(0))}).attr("stroke-dasharray",
function(d){return gwCharts.calculateBarStroke(barWidth,barHeightProvider(d),d)})});if(spec.dualAxisSpec)barChart.renderSecondAxisLine(chart,spec);if(spec.noData)gwCharts.noDataGridChart(chart,spec.noData);if(withAxes)chart.renderHorizontalAxes(spec,chart.xAxisDetails.scale)}};function getXOffset(scaleBandwidth,barWidth,seriesIndex,seriesCount){var offset=scaleBandwidth-barWidth;if(offset===0)return offset;var middleSeriesIndex=seriesCount/2;var evenSeriesCount=seriesCount%2==0;var oddSeriesFactor=
evenSeriesCount?0:.5;var oddSeriesOffset=evenSeriesCount?0:offset/2;if(seriesIndex<middleSeriesIndex){var factor=middleSeriesIndex-seriesIndex-oddSeriesFactor;return factor*offset+oddSeriesOffset}else{var factor=-1*(seriesIndex-middleSeriesIndex-oddSeriesFactor);return factor*offset-oddSeriesOffset}}};barChart.renderSecondAxisLine=function(chart,chartSpec){var dualAxisTooltipProvider=function(d,seriesName){return seriesName+": "+gwCharts.getTooltipFormatter()(d)};var xValueProvider=function(d,i){return chart.xAxisDetails.scale(chartSpec.data.categories[i])};
var yValueProvider=function(d){return chartSpec.dualAxisSpec.yScale(d)};gwCharts.renderSecondAxisLine(chart,chartSpec,chartSpec.dualAxisSpec,xValueProvider,yValueProvider,dualAxisTooltipProvider,{transposeData:true,xOffset:chart.xAxisDetails.scale.bandwidth()/2})};barChart.getBarWidth=function(scaleBandwidth){return scaleBandwidth<=MAX_BAR_WIDTH?scaleBandwidth:MAX_BAR_WIDTH}});gw.globals.chartInitializers=gw.globals.chartInitializers||[];gw.globals.chartInitializers.push(function(gw,gwCharts){var donutChart=gwCharts.donutChart={};donutChart.initSeriesVisibility=gwCharts.initSeriesVisibilityForRoundChart;donutChart.toggleOneActiveSeries=gwCharts.toggleOneActiveSeriesForRoundChart;donutChart.toggleSeriesVisibility=gwCharts.toggleSeriesVisibilityForRoundChart;donutChart.getRenderer=function(id,spec){return gwCharts.roundChart.getRenderer(id,spec,.6)}});gw.globals.chartInitializers=gw.globals.chartInitializers||[];
gw.globals.chartInitializers.push(function(gw,gwCharts){var lineChart=gwCharts.lineChart={};var LINE_CIRCLE_R="3px";var LINE_STROKE_WIDTH="2px";lineChart.initSeriesVisibility=gwCharts.initSeriesVisibilityForAxisChart;lineChart.toggleOneActiveSeries=gwCharts.toggleOneActiveSeriesForAxisChart;lineChart.toggleSeriesVisibility=gwCharts.toggleSeriesVisibilityForAxisChart;lineChart.getXAxisTicks=gwCharts.createXAxisLabels;lineChart.getRenderer=function(id,spec){var yAxisMinMaxRange=gwCharts.axisRange(spec.yaxis,
gwCharts.categoryDataMinMaxYRange(spec.data));var categories=spec.data.categories;var yScaleFactory=function(chartHeight){return gwCharts.getNumericalAxisScale(spec.yaxis,yAxisMinMaxRange,chartHeight)};var xScaleFactory=function(chartWidth){return d3.scalePoint().domain(spec.data.categories).range([0,chartWidth])};var chart=new gwCharts.Chart(id,spec,yAxisMinMaxRange,xScaleFactory,yScaleFactory);var tooltipProvider=function(d,seriesName){return seriesName+": "+gwCharts.getTooltipFormatter()(d)};var xValueProvider=
function(d,i){return chart.xAxisDetails.scale(categories[i])};var yValueProvider=function(d){return chart.yAxisDetails.scale(d)};return{render:function(withAxes){var keys=gwCharts.getActiveSeriesKeys(spec.data.series);var data=d3.transpose(spec.data.valuesPerCategory).filter(function(serialValues,id){return keys.indexOf(id)>=0});if(withAxes)chart.renderVerticalAxes(spec);chart.body.selectAll("g[data-gw-chart-series]").remove();gwCharts.lineChart.renderLine(chart,spec,"gw-chart-series",tooltipProvider,
xValueProvider,yValueProvider,data,keys);if(spec.dualAxisSpec){var dualYValueProvider=function(d){return spec.dualAxisSpec.yScale(d)};gwCharts.renderSecondAxisLine(chart,spec,spec.dualAxisSpec,xValueProvider,dualYValueProvider,tooltipProvider,{transposeData:true})}if(withAxes)chart.renderHorizontalAxes(spec,chart.xAxisDetails.scale)}}};lineChart.renderLine=function(chart,spec,className,tooltipProvider,xValueProvider,yValueProvider,data,seriesKeys,offset,ignoreColorPalette){var selectName="g."+className;
var xOffset=offset&&offset.xOffset?offset.xOffset:0;var seriesDetails=gwCharts.seriesDetails(spec.data.series);var lineGen=d3.line().x(xValueProvider).y(yValueProvider);chart.body.selectAll(selectName).data(data).enter().append("g").attr("data-gw-chart-series",function(d,i){return seriesDetails.getNormalizedName(seriesKeys[i])}).attr("data-gw-dblclick","gwCharts.toggleOneActiveSeries").attr("transform",function(){return"translate("+xOffset+", 0)"}).attr("class",function(d,i){return gwCharts.classes(!ignoreColorPalette&&
seriesDetails.getClassNames(seriesKeys[i]),className)}).append("path").attr("stroke",function(d,i){return seriesDetails.getCustomStrokeColor(seriesKeys[i])}).attr("stroke-width",LINE_STROKE_WIDTH).style("fill","none").attr("d",lineGen);var seriesPointSelectName="g."+className+"-series-point";var circleClassName=className+"-circle";chart.body.selectAll(seriesPointSelectName).data(data).enter().append("g").attr("data-gw-chart-series",function(d,i){return seriesDetails.getNormalizedName(seriesKeys[i])}).attr("data-gw-dblclick",
"gwCharts.toggleOneActiveSeries").attr("transform",function(d,i){return"translate("+xOffset+", 0)"}).attr("class",className+"-series-point").each(function(seriesData,seriesIndex){var seriesOffset=seriesKeys?seriesKeys[seriesIndex]:seriesIndex;d3.select(this).selectAll("circle."+circleClassName).data(seriesData).enter().append("circle").attr("class",className+"-circle").attr("cx",xValueProvider).attr("cy",yValueProvider).attr("class",function(){return gwCharts.classes(!ignoreColorPalette&&seriesDetails.getClassNames(seriesOffset),
circleClassName)}).attr("stroke",function(){return seriesDetails.getCustomStrokeColor(seriesOffset)}).attr("fill",function(){return seriesDetails.getCustomFillColor(seriesOffset)}).attr("r",LINE_CIRCLE_R).attr("stroke-width",LINE_STROKE_WIDTH)});if(spec.noData)gwCharts.noDataGridChart(chart,spec.noData);gwCharts.renderToolTips(chart,spec,className,tooltipProvider,xValueProvider,yValueProvider,data,xOffset,seriesKeys,ignoreColorPalette)}});gw.globals.chartInitializers=gw.globals.chartInitializers||[];gw.globals.chartInitializers.push(function(gw,gwCharts){var pieChart=gwCharts.pieChart={};pieChart.initSeriesVisibility=gwCharts.initSeriesVisibilityForRoundChart;pieChart.toggleOneActiveSeries=gwCharts.toggleOneActiveSeriesForRoundChart;pieChart.toggleSeriesVisibility=gwCharts.toggleSeriesVisibilityForRoundChart;pieChart.getRenderer=function(id,spec){return gwCharts.roundChart.getRenderer(id,spec,0)}});gw.globals.chartInitializers=gw.globals.chartInitializers||[];
gw.globals.chartInitializers.push(function(gw,gwCharts){var roundChart=gwCharts.roundChart={};function sumArray(anArray){if(Array.isArray(anArray))return anArray.reduce(function(acc,val){return 0+acc+val},0);throw"Unable to sum a non-array: "+anArray;}function getCustomCategoryColors(chartSpec){if(chartSpec.data.series[0]&&chartSpec.data.series[0].fills)return chartSpec.data.series[0].fills.map(function(color,index){return{colorSet:true,fill:color,stroke:chartSpec.data.series[0].strokes[index]}})}
function renderEmptyPieChart(chartSpec,chart,radius){var height=chart.height+chart.spacing.topMargin+chart.spacing.bottomMargin;var width=chart.width+chart.spacing.leftMargin+chart.spacing.rightMargin;var emptyChart=chart.body.attr("transform",null).attr("class","gw-chart-placeholder").append("g").attr("class","gw-chart-pie").attr("data-gw-nodata",true);emptyChart.append("circle").attr("class","gw-ph-dark").attr("cx",width/2).attr("cy",height/2).attr("r",radius);emptyChart.append("path").attr("d",
window.GwPathBuilder.create(width/2,height/2).lineToDegreeOnCircle(width/2,height/2,radius,20).arcAlongCircle(width/2,height/2,radius,31).close()).attr("class","gw-ph-medium");emptyChart.append("path").attr("d",window.GwPathBuilder.create(width/2,height/2).lineToDegreeOnCircle(width/2,height/2,radius,31).arcAlongCircle(width/2,height/2,radius,52).close()).attr("class","gw-ph-light");emptyChart.append("path").attr("d",window.GwPathBuilder.create(width/2,height/2).lineToDegreeOnCircle(width/2,height/
2,radius,180).arcAlongCircle(width/2,height/2,radius,265).close()).attr("class","gw-ph-light");emptyChart.append("path").attr("d",window.GwPathBuilder.create(width/2,height/2).lineToDegreeOnCircle(width/2,height/2,radius,265).arcAlongCircle(width/2,height/2,radius,320).close()).attr("class","gw-ph-medium");emptyChart.append("path").attr("d",window.GwPathBuilder.create(width/2,height/2).lineToDegreeOnCircle(width/2,height/2,radius,320).arcAlongCircle(width/2,height/2,radius,360).close()).attr("class",
"gw-ph-light");emptyChart.append("text").attr("x",width/2).attr("y",height/2+radius*.4).attr("text-anchor","middle").text(chartSpec.noData||gw.globals.gwDisplayKey.get("Web.Client.ChartZeroSumValue"))}roundChart.getRenderer=function(id,chartSpec,innerRadiusFactor){var colors=getCustomCategoryColors(chartSpec);var colorsOffset=colors?-colors.length:0;var legendSeries=chartSpec.data.categories.map(function(category,index){return $.extend({name:category,active:chartSpec.data.categoriesVisibility[index]},
colors&&colors[index]||{colorSet:false})});var chart=new gwCharts.Chart(id,chartSpec,null,null,null,legendSeries,colorsOffset);return{render:function(){var radius=Math.min(chart.width,chart.height)/2;var innerRadius=radius*innerRadiusFactor;var activeCategories=chartSpec.data.categories.filter(function(category,index){return chartSpec.data.categoriesVisibility[index]});var dataSet=d3.transpose(chartSpec.data.valuesPerCategory.filter(function(category,index){return chartSpec.data.categoriesVisibility[index]}))[0];
var valueSum=dataSet===undefined?0:sumArray(dataSet);chart.body.selectAll(".gw-chart-pie").remove();if(valueSum===0){renderEmptyPieChart(chartSpec,chart,radius);return}var arc=d3.arc().innerRadius(innerRadius).outerRadius(radius);var pie=d3.pie().sort(null);var theChart=chart.body.append("g").attr("class","gw-chart-pie");theChart.attr("transform","translate("+(chart.width/2-radius)+",0)");var wedges=theChart.selectAll("g.gw-chart-pie-wedge").data(pie(dataSet)).enter().append("g").attr("class","gw-chart-pie-wedge").attr("transform",
"translate("+(radius+gw.globals.gwCharts.STROKE_WIDTH)+", "+(radius+gw.globals.gwCharts.STROKE_WIDTH)+")");var getValueDetailInfo=function(dataValue){var formattedNumericValue=gwCharts.getTooltipFormatter()(dataValue);if(valueSum>0)return formattedNumericValue+"; "+d3.format(".0%")(dataValue/valueSum);return formattedNumericValue};var visibleIndexes=[];chartSpec.data.categoriesVisibility.forEach(function(isVisible,index){if(isVisible)visibleIndexes.push(index)});var visibleCustomColors=colors&&colors.filter(function(color,
i){return visibleIndexes.indexOf(i)>-1});var seriesDetails=gwCharts.seriesDetails(colors);wedges.append("path").attr("class",function(d,i){return gwCharts.classes(seriesDetails.getClassNames(visibleIndexes[i],colorsOffset),{"gw-chart-wedge":!(visibleCustomColors&&visibleCustomColors[i]&&visibleCustomColors[i].stroke)})}).attr("d",arc).attr("data-gw-tooltip",function(d,i){return activeCategories[i]+" ("+getValueDetailInfo(d.data)+")"}).attr("fill",function(d,i){return seriesDetails.getCustomFillColor(visibleIndexes[i])}).attr("stroke",
function(d,i){return seriesDetails.getCustomStrokeColor(visibleIndexes[i])}).attr("stroke-width",gw.globals.gwCharts.STROKE_WIDTH).each(function(d){this._current=d})}}};roundChart.calculateSpacing=function(rect,chartSpec){var radius=Math.min(rect.width,rect.height)/2;return{leftMargin:chartSpec.insetPadding,rightMargin:chartSpec.insetPadding,topMargin:chartSpec.insetPadding+rect.height/2-radius,bottomMargin:chartSpec.insetPadding}}});gw.globals.chartInitializers=gw.globals.chartInitializers||[];
gw.globals.chartInitializers.push(function(gw,gwCharts){var stackedBarChart=gwCharts.stackedBarChart={};var BAR_STROKE_WIDTH=1;stackedBarChart.initSeriesVisibility=gwCharts.initSeriesVisibilityForAxisChart;stackedBarChart.toggleOneActiveSeries=gwCharts.toggleOneActiveSeriesForAxisChart;stackedBarChart.toggleSeriesVisibility=gwCharts.toggleSeriesVisibilityForAxisChart;stackedBarChart.getXAxisTicks=gwCharts.createXAxisLabels;stackedBarChart.getRenderer=function(id,spec){var seriesDetails=gwCharts.seriesDetails(spec.data.series);
var seriesCount=spec.data.series.length;var stack=d3.stack().offset(d3.stackOffsetDiverging).keys(d3.range(0,seriesCount));var stackedData=stack(spec.data.valuesPerCategory);var yAxisMinMaxRange=gwCharts.axisRange(spec.yaxis,gwCharts.stackedDataMinMaxYRange(stackedData));var xScaleFactory=function(chartWidth){return d3.scaleBand().padding(.2).domain(spec.data.categories).range([0,chartWidth])};var yScaleFactory=function(chartHeight){return gwCharts.getNumericalAxisScale(spec.yaxis,yAxisMinMaxRange,
chartHeight)};var chart=new gwCharts.Chart(id,spec,yAxisMinMaxRange,xScaleFactory,yScaleFactory);return{render:function(withAxes){var activeSeriesKeys=gwCharts.getActiveSeriesKeys(spec.data.series);var data=d3.stack().offset(d3.stackOffsetDiverging).keys(activeSeriesKeys)(spec.data.valuesPerCategory);if(withAxes)chart.renderVerticalAxes(spec);chart.body.selectAll("g[data-gw-chart-series]").remove();chart.body.selectAll("g.gw-chart-series").data(data).enter().append("g").attr("data-gw-chart-series",
function(d,i){return seriesDetails.getNormalizedName(activeSeriesKeys[i])}).attr("data-gw-dblclick","gwCharts.toggleOneActiveSeries").attr("class",function(d,i){return gwCharts.classes(seriesDetails.getClassNames(activeSeriesKeys[i]),"gw-chart-series")}).attr("fill",function(d,i){return seriesDetails.getCustomFillColor(activeSeriesKeys[i])}).attr("stroke",function(d,i){return seriesDetails.getCustomStrokeColor(activeSeriesKeys[i])}).each(function(seriesData,seriesIndex){var seriesName=spec.data.series[activeSeriesKeys[seriesIndex]].name;
d3.select(this).selectAll("g.gw-chart-bar").data(seriesData).enter().append("g").attr("class","gw-chart-bar").each(function(barData,barIndex){var barGroupElement=d3.select(this);var hasCustomColor=seriesDetails.isCustomColor(activeSeriesKeys[seriesIndex]);drawBar(barGroupElement,barData,barIndex,seriesName,hasCustomColor)})});if(spec.dualAxisSpec)gwCharts.barChart.renderSecondAxisLine(chart,spec);if(spec.noData)gwCharts.noDataGridChart(chart,spec.noData);if(withAxes)chart.renderHorizontalAxes(spec,
chart.xAxisDetails.scale)}};function drawBar(barGroupElement,barData,barIndex,seriesName,hasCustomColor){var barHeight=Math.abs(chart.yAxisDetails.scale(barData[0])-chart.yAxisDetails.scale(barData[1]));if(barHeight===0)return;var scaleBandwidth=chart.xAxisDetails.scale.bandwidth();var barWidth=gwCharts.barChart.getBarWidth(scaleBandwidth);var xOffset=getXOffset(scaleBandwidth,barWidth);var xCoord=chart.xAxisDetails.scale(spec.data.categories[barIndex])+xOffset;var yCoord=chart.yAxisDetails.scale(Math.max(barData[1],
barData[0]))+(barData[0]<0?1:0);var isBaseBar=barData[0]===0||barData[1]===0;barGroupElement.append("rect").attr("class","gw-bar-element").attr("x",xCoord).attr("y",yCoord).attr("width",barWidth).attr("height",barHeight).attr("data-gw-tooltip",function(){return seriesName+": "+gwCharts.getTooltipFormatter()(barData[0]>=0?barData[1]-barData[0]:barData[0]-barData[1])});if(isBaseBar)barGroupElement.attr("stroke-dasharray",gwCharts.calculateBarStroke(barWidth,barHeight,barData[1]));else if(!hasCustomColor){var y=
yCoord+(barData[1]<0?0:barHeight);barGroupElement.append("line").attr("class","gw-bars-separator").attr("x1",xCoord-BAR_STROKE_WIDTH).attr("y1",y).attr("x2",xCoord+barWidth+BAR_STROKE_WIDTH).attr("y2",y).attr("stroke-width",BAR_STROKE_WIDTH)}}function getXOffset(scaleBandwidth,barWidth){if(barWidth<scaleBandwidth)return(scaleBandwidth-barWidth)/2;return 0}}});gw.globals.chartInitializers=gw.globals.chartInitializers||[];
gw.globals.chartInitializers.push(function(gw,gwCharts){var timeSeriesChart=gwCharts.timeSeriesChart={};function createXScale(chartSpec,width){var minTimeValue=Math.min(chartSpec.dualData?chartSpec.dualData.minTimeValue:chartSpec.data.minTimeValue,chartSpec.data.minTimeValue);var maxTimeValue=Math.max(chartSpec.dualData?chartSpec.dualData.maxTimeValue:chartSpec.data.maxTimeValue,chartSpec.data.maxTimeValue);return d3.scaleTime().domain(gwCharts.axisRange(chartSpec.xaxis,[minTimeValue,maxTimeValue])).range([0,
width]).nice()}timeSeriesChart.initSeriesVisibility=gwCharts.initSeriesVisibilityForAxisChart;timeSeriesChart.toggleOneActiveSeries=gwCharts.toggleOneActiveSeriesForAxisChart;timeSeriesChart.toggleSeriesVisibility=gwCharts.toggleSeriesVisibilityForAxisChart;timeSeriesChart.getXAxisTicks=function(chartSpec){return createXScale(chartSpec,100).ticks().map(function(tick){return timeSeriesChart.dateFormatter(chartSpec.xaxis.dateFormat,tick)})};timeSeriesChart.getRenderer=function(id,spec){var data=spec.data.seriesValues;
var yAxisMinMaxRange=gwCharts.axisRange(spec.yaxis,gwCharts.seriesMinMaxDataPointRange(data,function(dataPoint){return dataPoint.y}));var xScaleFactory=function(chartWidth){return createXScale(spec,chartWidth)};var yScaleFactory=function(chartHeight){return gwCharts.getNumericalAxisScale(spec.yaxis,yAxisMinMaxRange,chartHeight)};var chart=new gwCharts.Chart(id,spec,yAxisMinMaxRange,xScaleFactory,yScaleFactory);var xValueProvider=function(d){return chart.xAxisDetails.scale(d.x)};var yValueProvider=
function(d){return chart.yAxisDetails.scale(d.y)};var tooltipProviderFactory=function(dateFormat,numberFormatter){return function(d,seriesName){return seriesName+": ("+timeSeriesChart.dateFormatter(dateFormat,d.x)+"; "+numberFormatter(d.y)+")"}};return{render:function(withAxes){var keys=gwCharts.getActiveSeriesKeys(spec.data.series);var data=spec.data.seriesValues.filter(function(serialValues,id){return keys.indexOf(id)>=0});if(withAxes)chart.renderVerticalAxes(spec);chart.body.selectAll("g[data-gw-chart-series]").remove();
gwCharts.lineChart.renderLine(chart,spec,"gw-chart-time",tooltipProviderFactory(spec.xaxis.dateFormat,gwCharts.getTooltipFormatter()),xValueProvider,yValueProvider,data,keys);if(spec.dualAxisSpec){var dualYValueProvider=function(d){return spec.dualAxisSpec.yScale(d.y)};var dualAxisTooltipProvider=tooltipProviderFactory(spec.dualAxis.dateFormat,gwCharts.getTooltipFormatter());gwCharts.renderSecondAxisLine(chart,spec,spec.dualAxisSpec,xValueProvider,dualYValueProvider,dualAxisTooltipProvider)}if(withAxes)chart.renderHorizontalAxes(spec,
chart.xAxisDetails.scale)}}};timeSeriesChart.dateFormatter=function(dateFormat,date){return d3.timeFormatLocale({dateTime:dateFormat,periods:gw.globals.gwLocale.getPeriods(),days:gw.globals.gwLocale.getWeekdays(),shortDays:gw.globals.gwLocale.getShortWeekdays(),months:gw.globals.gwLocale.getMonths(),shortMonths:gw.globals.gwLocale.getShortMonths()}).utcFormat("%c")(date)}});gw.globals.chartInitializers=gw.globals.chartInitializers||[];
gw.globals.chartInitializers.push(function(gw,gwCharts){var xylineChart=gwCharts.xylineChart={};function getXAxisRange(spec){var dataPoints=spec.data.seriesValues;dataPoints=spec.dualData?dataPoints.concat(spec.dualData.seriesValues):dataPoints;return gwCharts.axisRange(spec.xaxis,gwCharts.seriesMinMaxDataPointRange(dataPoints,function(d){return d.x}))}xylineChart.initSeriesVisibility=gwCharts.initSeriesVisibilityForAxisChart;xylineChart.toggleOneActiveSeries=gwCharts.toggleOneActiveSeriesForAxisChart;
xylineChart.toggleSeriesVisibility=gwCharts.toggleSeriesVisibilityForAxisChart;xylineChart.getXAxisTicks=function(chartSpec){return gwCharts.getTicksValues({scale:gwCharts.getNumericalAxisScale(chartSpec.xaxis,getXAxisRange(chartSpec),100,true)},chartSpec.xaxis.useWholeNumber)};xylineChart.getRenderer=function(id,spec){var yAxisMinMaxRange=gwCharts.axisRange(spec.yaxis,gwCharts.seriesMinMaxDataPointRange(spec.data.seriesValues,function(dataPoint){return dataPoint.y}));var xScaleFactory=function(chartWidth){return gwCharts.getNumericalAxisScale(spec.xaxis,
getXAxisRange(spec),chartWidth,true)};var yScaleFactory=function(chartHeight){return gwCharts.getNumericalAxisScale(spec.yaxis,yAxisMinMaxRange,chartHeight)};var chart=new gwCharts.Chart(id,spec,yAxisMinMaxRange,xScaleFactory,yScaleFactory);var tooltipProvider=function(d,seriesName){return seriesName+": ("+gwCharts.getTooltipFormatter()(d.x)+"; "+gwCharts.getTooltipFormatter()(d.y)+")"};var xValueProvider=function(d){return chart.xAxisDetails.scale(d.x)};var yValueProvider=function(d){return chart.yAxisDetails.scale(d.y)};
return{render:function(withAxes){var keys=gwCharts.getActiveSeriesKeys(spec.data.series);var data=spec.data.seriesValues.filter(function(serialValues,id){return keys.indexOf(id)>=0});if(withAxes)chart.renderVerticalAxes(spec);chart.body.selectAll("g[data-gw-chart-series]").remove();gwCharts.lineChart.renderLine(chart,spec,"gw-chart-series",tooltipProvider,xValueProvider,yValueProvider,data,keys);if(spec.dualAxisSpec){var dualYValueProvider=function(d){return spec.dualAxisSpec.yScale(d.y)};var dualTooltipProvider=
function(d,seriesName){return seriesName+": ("+gwCharts.getTooltipFormatter()(d.x)+"; "+gwCharts.getTooltipFormatter()(d.y)+")"};gwCharts.renderSecondAxisLine(chart,spec,spec.dualAxisSpec,xValueProvider,dualYValueProvider,dualTooltipProvider)}if(withAxes)chart.renderHorizontalAxes(spec,chart.xAxisDetails.scale)}}}});(function(){var EXIF=function(obj){if(obj instanceof EXIF)return obj;return new EXIF(obj)};gw.globals.EXIF=EXIF;EXIF.enableXmp=function(){EXIF.isXmpEnabled=true};EXIF.disableXmp=function(){EXIF.isXmpEnabled=false};EXIF.buildDataAsync=function(img,cb){if((Image&&img instanceof Image||HTMLImageElement&&img instanceof HTMLImageElement)&&!img.complete)return false;if(!imageHasData(img))buildImageData(img,cb);else if(cb)cb(img.exifdata);return true};EXIF.getTagFromBuiltImg=function(img,tag){if(!imageHasData(img))return;
return img.exifdata[tag]};EXIF.getIptcTagFromBuiltImg=function(img,tag){if(!imageHasData(img))return;return img.iptcdata[tag]};EXIF.getAllTagsFromBuiltImg=function(img){if(!imageHasData(img))return{};var key,data=img.exifdata,tags={};for(key in data)if(data.hasOwnProperty(key))tags[key]=data[key];return tags};EXIF.getAllIptcTagsFromBuiltImg=function(img){if(!imageHasData(img))return{};var key,data=img.iptcdata,tags={};for(key in data)if(data.hasOwnProperty(key))tags[key]=data[key];return tags};EXIF.prettifyBuiltImg=
function(img){if(!imageHasData(img))return"";var key,data=img.exifdata,strPretty="";for(key in data)if(data.hasOwnProperty(key))if(typeof data[key]=="object")if(data[key]instanceof Number)strPretty+=key+" : "+data[key]+" ["+data[key].numerator+"/"+data[key].denominator+"]\r\n";else strPretty+=key+" : ["+data[key].length+" values]\r\n";else strPretty+=key+" : "+data[key]+"\r\n";return strPretty};EXIF.readFromBinaryFile=function(file){return findEXIFinJPEG(file)};var ExifTags=EXIF.Tags={36864:"ExifVersion",
40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",
37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",
41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"};var TiffTags=EXIF.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",
274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"};
var GPSTags=EXIF.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",
26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"};var IFD1Tags=EXIF.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",
531:"YCbCrPositioning",532:"ReferenceBlackWhite"};var StringValues=EXIF.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",
10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",
15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",
77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",
5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},
Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function imageHasData(img){return!!img.exifdata}function base64ToArrayBuffer(base64,contentType){contentType=contentType||base64.match(/^data:([^;]+);base64,/mi)[1]||"";base64=base64.replace(/^data:([^;]+);base64,/gmi,"");var binary=atob(base64);var len=binary.length;var buffer=new ArrayBuffer(len);var view=
new Uint8Array(buffer);for(var i=0;i<len;i++)view[i]=binary.charCodeAt(i);return buffer}function objectURLToBlob(url,cb){var http=new XMLHttpRequest;http.open("GET",url,true);http.responseType="blob";http.onload=function(e){if(this.status==200||this.status===0)cb(this.response)};http.send()}function buildImageData(img,cb){function handleBinaryFile(binFile){var data=findEXIFinJPEG(binFile);img.exifdata=data||{};var iptcdata=findIPTCinJPEG(binFile);img.iptcdata=iptcdata||{};if(EXIF.isXmpEnabled){var xmpdata=
findXMPinJPEG(binFile);img.xmpdata=xmpdata||{}}if(cb)cb(img.exifdata)}if(img.src)if(/^data:/i.test(img.src)){var arrayBuffer=base64ToArrayBuffer(img.src);handleBinaryFile(arrayBuffer)}else if(/^blob:/i.test(img.src)){var fileReader=new FileReader;fileReader.onload=function(e){handleBinaryFile(e.target.result)};objectURLToBlob(img.src,function(blob){fileReader.readAsArrayBuffer(blob)})}else{var http=new XMLHttpRequest;http.onload=function(){if(this.status==200||this.status===0)handleBinaryFile(http.response);
else throw"Could not load image";http=null};http.open("GET",img.src,true);http.responseType="arraybuffer";http.send(null)}else if(FileReader&&(img instanceof Blob||img instanceof File)){var fileReader=new FileReader;fileReader.onload=function(e){handleBinaryFile(e.target.result)};fileReader.readAsArrayBuffer(img)}}function findEXIFinJPEG(file){var dataView=new DataView(file);if(dataView.getUint8(0)!=255||dataView.getUint8(1)!=216)return false;var offset=2,length=file.byteLength,marker;while(offset<
length){if(dataView.getUint8(offset)!=255){console.log("Not a valid marker at offset "+offset+", found: "+dataView.getUint8(offset));return false}marker=dataView.getUint8(offset+1);if(marker==225)return readEXIFData(dataView,offset+4,dataView.getUint16(offset+2)-2);else offset+=2+dataView.getUint16(offset+2)}}function findIPTCinJPEG(file){var dataView=new DataView(file);if(dataView.getUint8(0)!=255||dataView.getUint8(1)!=216)return false;var offset=2,length=file.byteLength;var isFieldSegmentStart=
function(dataView,offset){return dataView.getUint8(offset)===56&&dataView.getUint8(offset+1)===66&&dataView.getUint8(offset+2)===73&&dataView.getUint8(offset+3)===77&&dataView.getUint8(offset+4)===4&&dataView.getUint8(offset+5)===4};while(offset<length){if(isFieldSegmentStart(dataView,offset)){var nameHeaderLength=dataView.getUint8(offset+7);if(nameHeaderLength%2!==0)nameHeaderLength+=1;if(nameHeaderLength===0)nameHeaderLength=4;var startOffset=offset+8+nameHeaderLength;var sectionLength=dataView.getUint16(offset+
6+nameHeaderLength);return readIPTCData(file,startOffset,sectionLength)}offset++}}var IptcFieldMap={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function readIPTCData(file,startOffset,sectionLength){var dataView=new DataView(file);var data={};var fieldValue,fieldName,dataSize,segmentType,segmentSize;var segmentStartPos=startOffset;while(segmentStartPos<startOffset+sectionLength){if(dataView.getUint8(segmentStartPos)===
28&&dataView.getUint8(segmentStartPos+1)===2){segmentType=dataView.getUint8(segmentStartPos+2);if(segmentType in IptcFieldMap){dataSize=dataView.getInt16(segmentStartPos+3);segmentSize=dataSize+5;fieldName=IptcFieldMap[segmentType];fieldValue=getStringFromDB(dataView,segmentStartPos+5,dataSize);if(data.hasOwnProperty(fieldName))if(data[fieldName]instanceof Array)data[fieldName].push(fieldValue);else data[fieldName]=[data[fieldName],fieldValue];else data[fieldName]=fieldValue}}segmentStartPos++}return data}
function readTags(file,tiffStart,dirStart,strings,bigEnd){var entries=file.getUint16(dirStart,!bigEnd),tags={},entryOffset,tag,i;for(i=0;i<entries;i++){entryOffset=dirStart+i*12+2;tag=strings[file.getUint16(entryOffset,!bigEnd)];tags[tag]=readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd)}return tags}function readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd){var type=file.getUint16(entryOffset+2,!bigEnd),numValues=file.getUint32(entryOffset+4,!bigEnd),valueOffset=file.getUint32(entryOffset+
8,!bigEnd)+tiffStart,offset,vals,val,n,numerator,denominator;switch(type){case 1:case 7:if(numValues==1)return file.getUint8(entryOffset+8,!bigEnd);else{offset=numValues>4?valueOffset:entryOffset+8;vals=[];for(n=0;n<numValues;n++)vals[n]=file.getUint8(offset+n);return vals}case 2:offset=numValues>4?valueOffset:entryOffset+8;return getStringFromDB(file,offset,numValues-1);case 3:if(numValues==1)return file.getUint16(entryOffset+8,!bigEnd);else{offset=numValues>2?valueOffset:entryOffset+8;vals=[];for(n=
0;n<numValues;n++)vals[n]=file.getUint16(offset+2*n,!bigEnd);return vals}case 4:if(numValues==1)return file.getUint32(entryOffset+8,!bigEnd);else{vals=[];for(n=0;n<numValues;n++)vals[n]=file.getUint32(valueOffset+4*n,!bigEnd);return vals}case 5:if(numValues==1){numerator=file.getUint32(valueOffset,!bigEnd);denominator=file.getUint32(valueOffset+4,!bigEnd);val=new Number(numerator/denominator);val.numerator=numerator;val.denominator=denominator;return val}else{vals=[];for(n=0;n<numValues;n++){numerator=
file.getUint32(valueOffset+8*n,!bigEnd);denominator=file.getUint32(valueOffset+4+8*n,!bigEnd);vals[n]=new Number(numerator/denominator);vals[n].numerator=numerator;vals[n].denominator=denominator}return vals}case 9:if(numValues==1)return file.getInt32(entryOffset+8,!bigEnd);else{vals=[];for(n=0;n<numValues;n++)vals[n]=file.getInt32(valueOffset+4*n,!bigEnd);return vals}case 10:if(numValues==1)return file.getInt32(valueOffset,!bigEnd)/file.getInt32(valueOffset+4,!bigEnd);else{vals=[];for(n=0;n<numValues;n++)vals[n]=
file.getInt32(valueOffset+8*n,!bigEnd)/file.getInt32(valueOffset+4+8*n,!bigEnd);return vals}}}function getNextIFDOffset(dataView,dirStart,bigEnd){var entries=dataView.getUint16(dirStart,!bigEnd);return dataView.getUint32(dirStart+2+entries*12,!bigEnd)}function readThumbnailImage(dataView,tiffStart,firstIFDOffset,bigEnd){var IFD1OffsetPointer=getNextIFDOffset(dataView,tiffStart+firstIFDOffset,bigEnd);if(!IFD1OffsetPointer)return{};else if(IFD1OffsetPointer>dataView.byteLength)return{};var thumbTags=
readTags(dataView,tiffStart,tiffStart+IFD1OffsetPointer,IFD1Tags,bigEnd);if(thumbTags["Compression"])switch(thumbTags["Compression"]){case 6:if(thumbTags.JpegIFOffset&&thumbTags.JpegIFByteCount){var tOffset=tiffStart+thumbTags.JpegIFOffset;var tLength=thumbTags.JpegIFByteCount;thumbTags["blob"]=new Blob([new Uint8Array(dataView.buffer,tOffset,tLength)],{type:"image/jpeg"})}break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",
thumbTags["Compression"])}else if(thumbTags["PhotometricInterpretation"]==2)console.log("Thumbnail image format is RGB, which is not implemented.");return thumbTags}function getStringFromDB(buffer,start,length){var outstr="";for(var n=start;n<start+length;n++)outstr+=String.fromCharCode(buffer.getUint8(n));return outstr}function readEXIFData(file,start){if(getStringFromDB(file,start,4)!="Exif"){console.log("Not valid EXIF data! "+getStringFromDB(file,start,4));return false}var bigEnd,tags,tag,exifData,
gpsData,tiffOffset=start+6;if(file.getUint16(tiffOffset)==18761)bigEnd=false;else if(file.getUint16(tiffOffset)==19789)bigEnd=true;else{console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)");return false}if(file.getUint16(tiffOffset+2,!bigEnd)!=42){console.log("Not valid TIFF data! (no 0x002A)");return false}var firstIFDOffset=file.getUint32(tiffOffset+4,!bigEnd);if(firstIFDOffset<8){console.log("Not valid TIFF data! (First offset less than 8)",file.getUint32(tiffOffset+4,!bigEnd));return false}tags=
readTags(file,tiffOffset,tiffOffset+firstIFDOffset,TiffTags,bigEnd);if(tags.ExifIFDPointer){exifData=readTags(file,tiffOffset,tiffOffset+tags.ExifIFDPointer,ExifTags,bigEnd);for(tag in exifData){switch(tag){case "LightSource":case "Flash":case "MeteringMode":case "ExposureProgram":case "SensingMethod":case "SceneCaptureType":case "SceneType":case "CustomRendered":case "WhiteBalance":case "GainControl":case "Contrast":case "Saturation":case "Sharpness":case "SubjectDistanceRange":case "FileSource":exifData[tag]=
StringValues[tag][exifData[tag]];break;case "ExifVersion":case "FlashpixVersion":exifData[tag]=String.fromCharCode(exifData[tag][0],exifData[tag][1],exifData[tag][2],exifData[tag][3]);break;case "ComponentsConfiguration":exifData[tag]=StringValues.Components[exifData[tag][0]]+StringValues.Components[exifData[tag][1]]+StringValues.Components[exifData[tag][2]]+StringValues.Components[exifData[tag][3]];break}tags[tag]=exifData[tag]}}if(tags.GPSInfoIFDPointer){gpsData=readTags(file,tiffOffset,tiffOffset+
tags.GPSInfoIFDPointer,GPSTags,bigEnd);for(tag in gpsData){switch(tag){case "GPSVersionID":gpsData[tag]=gpsData[tag][0]+"."+gpsData[tag][1]+"."+gpsData[tag][2]+"."+gpsData[tag][3];break}tags[tag]=gpsData[tag]}}tags["thumbnail"]=readThumbnailImage(file,tiffOffset,firstIFDOffset,bigEnd);return tags}function findXMPinJPEG(file){if(!("DOMParser"in self))return;var dataView=new DataView(file);console.log("Got file of length "+file.byteLength);if(dataView.getUint8(0)!=255||dataView.getUint8(1)!=216){console.log("Not a valid JPEG");
return false}var offset=2,length=file.byteLength,dom=new DOMParser;while(offset<length-4)if(getStringFromDB(dataView,offset,4)=="http"){var startOffset=offset-1;var sectionLength=dataView.getUint16(offset-2)-1;var xmpString=getStringFromDB(dataView,startOffset,sectionLength);var xmpEndIndex=xmpString.indexOf("xmpmeta\x3e")+8;xmpString=xmpString.substring(xmpString.indexOf("\x3cx:xmpmeta"),xmpEndIndex);var indexOfXmp=xmpString.indexOf("x:xmpmeta")+10;xmpString=xmpString.slice(0,indexOfXmp)+'xmlns:Iptc4xmpCore\x3d"http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" '+
'xmlns:xsi\x3d"http://www.w3.org/2001/XMLSchema-instance" '+'xmlns:tiff\x3d"http://ns.adobe.com/tiff/1.0/" '+'xmlns:plus\x3d"http://schemas.android.com/apk/lib/com.google.android.gms.plus" '+'xmlns:ext\x3d"http://www.gettyimages.com/xsltExtension/1.0" '+'xmlns:exif\x3d"http://ns.adobe.com/exif/1.0/" '+'xmlns:stEvt\x3d"http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" '+'xmlns:stRef\x3d"http://ns.adobe.com/xap/1.0/sType/ResourceRef#" '+'xmlns:crs\x3d"http://ns.adobe.com/camera-raw-settings/1.0/" '+
'xmlns:xapGImg\x3d"http://ns.adobe.com/xap/1.0/g/img/" '+'xmlns:Iptc4xmpExt\x3d"http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+xmpString.slice(indexOfXmp);var domDocument=dom.parseFromString(xmpString,"text/xml");return xml2Object(domDocument)}else offset++}function xml2json(xml){var json={};if(xml.nodeType==1){if(xml.attributes.length>0){json["@attributes"]={};for(var j=0;j<xml.attributes.length;j++){var attribute=xml.attributes.item(j);json["@attributes"][attribute.nodeName]=attribute.nodeValue}}}else if(xml.nodeType==
3)return xml.nodeValue;if(xml.hasChildNodes())for(var i=0;i<xml.childNodes.length;i++){var child=xml.childNodes.item(i);var nodeName=child.nodeName;if(json[nodeName]==null)json[nodeName]=xml2json(child);else{if(json[nodeName].push==null){var old=json[nodeName];json[nodeName]=[];json[nodeName].push(old)}json[nodeName].push(xml2json(child))}}return json}function xml2Object(xml){try{var obj={};if(xml.children.length>0)for(var i=0;i<xml.children.length;i++){var item=xml.children.item(i);var attributes=
item.attributes;for(var idx in attributes){var itemAtt=attributes[idx];var dataKey=itemAtt.nodeName;var dataValue=itemAtt.nodeValue;if(dataKey!==undefined)obj[dataKey]=dataValue}var nodeName=item.nodeName;if(typeof obj[nodeName]=="undefined")obj[nodeName]=xml2json(item);else{if(typeof obj[nodeName].push=="undefined"){var old=obj[nodeName];obj[nodeName]=[];obj[nodeName].push(old)}obj[nodeName].push(xml2json(item))}}else obj=xml.textContent;return obj}catch(e){console.log(e.message)}}})();(function(){var customSystem={};customSystem.getSystemName=function(){return"myCustomSystemInCustomerJs"};customSystem.init=function(isFullPageReload){if(isFullPageReload);};customSystem.availableToGlobal=function(){return false};gw.api.registerGlobalSystem(customSystem)})();
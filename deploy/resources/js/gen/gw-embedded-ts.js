!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var n in i)("object"==typeof exports?exports:e)[n]=i[n]}}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,i){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i(1)),n(i(2))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){throw new Error("Static class. Use GwCrossOriginExternal.init()")}return e.init=function(e,t,i){this.ownerWindow=i||window.parent,this.whiteListedDomains=t,this.originForGwApp=e,this.initialized=!0,this.messageEventListener=this.receiveMessageFromGwApp.bind(this),window.addEventListener("message",this.messageEventListener,!1)},e.isInitialized=function(){return this.initialized},e.kill=function(){this.initialized=!1,this.originForGwApp=void 0,this.messageEventListener&&(this.ownerWindow.removeEventListener("message",this.messageEventListener,!1),this.messageEventListener=void 0)},e.throwIfUntrustedOrigin=function(e){if(this.ownerWindow!==e.source||this.originForGwApp!==e.origin)throw new Error("Received untrusted message from origin: "+e.origin);if(e.data.gwNonGwOriginIfAny&&"*"!==this.whiteListedDomains&&!this.whiteListedDomains[e.data.gwNonGwOriginIfAny])throw new Error("Received message from trusted GW Application origin, but from an originating origin not on the whitelist.")},e.receiveMessageFromGwApp=function(e){if(this.initialized){this.throwIfUntrustedOrigin(e);var t=e.data;switch(t.gwMessageType){case 0:this.receiveValuesMessage(t);break;case 1:this.receiveNonBlockingServerRequestReponseMessage(t);break;case 2:this.receiveConfirmationOnlyMessage(t);break;case 3:this.receiveCrossOriginEvent(t);break;case 4:this.receiveGwNotification(t);break;default:this.receiveNonConformingMessageTypeFromGwApp(e)}}},e.getAwaitingInfoForCorrespondingMessageData=function(e){var t=e.gwResponseToMessageId;if(!t&&0!==t)return console.error("Received values payload with no responseToMessageId identifier: ",e),null;var i=this.messagesAwaitingResponse[t];return window.GwTestEnv?i:i||(console.error("Received values payload with a responseToMessageId: "+t+". But could not locate a corresponding Promise. Data: ",e),null)},e.receiveMessage=function(e){var t=e.gwPayload,i=e.gwStatus,n=this.getAwaitingInfoForCorrespondingMessageData(e);if(n){var s=2===i?n.reject:n.fulfill;s&&s(t)}},e.receiveNonBlockingServerRequestReponseMessage=function(e){this.receiveMessage(e)},e.receiveValuesMessage=function(e){this.receiveMessage(e)},e.receiveConfirmationOnlyMessage=function(e){this.receiveMessage(e)},e.receiveCrossOriginEvent=function(e){var t=e.gwPayload,i=this.crossOriginEventCallbackByBroadcasterThenEvent[t.broadcasterWindowId];if(!i)return void console.warn("Received cross origin event from a broadcast window not currently being listened to.");var n=i[t.eventName]||i["*"];n||console.warn("Received cross origin event for an event type without a registered callback: "+t.broadcasterWindowId+":"+t.eventName),n(t)},e.receiveGwNotification=function(e){var t=e.gwPayload,i=this.gwNotificationListeners[t.type];i&&i(t)},e.receiveNonConformingMessageTypeFromGwApp=function(e){var t=this[e.data.gwMessageType];if("function"==typeof t)return void this[t](e);console.warn("--- Received MessageEvent from GwApp without a gwMessageType that matched a method on GwCrossOriginExternal.\n--- This is likely an Error.\n--- However, receiveNonConformingMessageTypeFromGwApp can be overridden in GwCrossOriginExternal.\n--- This allows custom logic based on any MessageEvent that does not implement GwMessageEvent. But consider MessageType.FIRE_CUSTOM_EVENT instead.")},e.sendMessage=function(e,t,i){if(void 0===i&&(i=null),!this.ownerWindow)return Promise.reject(new Error("Attempting to send a message to a null GwApp window. Ensure that this window was spawned by a Guidwire Application."));var n=this.nextMessageId++,s={gwMessageType:e,gwPayload:t,gwStatus:3,gwMessageId:n,gwResponseToMessageId:i},r={messageId:n,timestamp:window.performance.now()};this.messagesAwaitingResponse[n]=r;try{var o=new Promise(function(e,t){r.fulfill=e,r.reject=t});return this.ownerWindow.postMessage(s,this.originForGwApp),o}catch(e){return Promise.reject(e)}},e.setValues=function(e){return this.sendMessage(0,e)},e.getValues=function(e){return this.sendMessage(1,e)},e.fireActionOnServer=function(e){return this.sendMessage(2,e)},e.makeNonBlockingServerRequest=function(e){return this.sendMessage(3,e)},e.addCrossOriginEventListener=function(e,t,i){var n=this.crossOriginEventCallbackByBroadcasterThenEvent[e]=this.crossOriginEventCallbackByBroadcasterThenEvent[e]||{};return n["*"]?Promise.reject(new Error("There is already an 'all' listener (`*`) for this broadcaster. Remove it before adding any other listeners: "+e+":"+t)):n[t]?Promise.reject(new Error("Cannot register multiple callbacks for the same broadcaster and event: "+e+":"+t)):("*"===t&&Object.keys(n).length>0&&(console.warn("Adding an 'all' listener of '*' to a broadcaster that already has more specific listener. All specific listeners will be removed. In order to avoid this warning, remove known listeners manually before adding."),n=this.crossOriginEventCallbackByBroadcasterThenEvent[e]={}),n[t]=i,this.sendMessage(5,{broadcasterWindowName:e,eventName:t}))},e.removeCrossOriginEventListener=function(e,t){var i=this.crossOriginEventCallbackByBroadcasterThenEvent[e];return i&&("*"===t?delete this.crossOriginEventCallbackByBroadcasterThenEvent[e]:delete i[t]),this.sendMessage(6,{broadcasterWindowName:e,eventName:t})},e.broadcastCrossOriginEvent=function(e,t){return 0===e.length||"*"===e?Promise.reject(new Error("Illegal eventName passed to fireCrossOriginEvent. Cannot be empty or the single `*` character: "+e)):this.sendMessage(4,{eventName:e,info:t})},e.addCallbackForGwNotificationType=function(e,t){if(this.gwNotificationListeners[e])throw new Error("Attempting to load multiple callbacks for notification type: "+e+". call removeCallbackBackForGWNotificationType first.");if(this.gwNotificationListeners["*"])throw new Error("Attempting to load a notification listener when their is already a * listener. New listener: "+e);this.gwNotificationListeners[e]=t},e.removeCallbackForGwNotificationType=function(e){this.gwNotificationListeners[e]||console.warn("Attempting to remove a non existent notification listener for: "+e),delete this.gwNotificationListeners[e]},e.nextMessageId=1e3,e.initialized=!1,e.messagesAwaitingResponse={},e.crossOriginEventCallbackByBroadcasterThenEvent={},e.gwNotificationListeners={},e.whiteListedDomains={},e}();t.GwCrossOriginExternal=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){if(this.subscriberPackages=[],this.result=void 0,e)try{e(this.beResolved.bind(this),this.beRejected.bind(this))}catch(e){this.beRejected(e)}}return e.reject=function(t){return new e(null).beRejected(t)},e.resolve=function(t){return t instanceof e?t:new e(null).beResolved(t)},e.all=function(t){var i=this;if(0===t.length)return e.resolve([]);var n=[],s=t.length,r=function(e,t){o.isPending()&&(n[e]=t,0===--s&&o.beResolved(n))},o=new e(function(n,s){for(var o=0;o<t.length;o++){var a=t[o];e.isThenable(a)?a.then(r.bind(i,o),s):r(o,a)}});return o},e.race=function(t){return new e(function(i,n){for(var s=0;s<t.length;s++){var r=t[s];e.isThenable(r)?r.then(i,n):i(r)}})},e.prototype.then=function(e,t){return this.addSubscriber(!1,e,t)},e.prototype.catch=function(e){return this.then(void 0,e)},e.prototype.finally=function(e){var t=function(t){return e(),t};return this.addSubscriber(!0,t,t)},e.prototype.addSubscriber=function(t,i,n){var s=this,r=new e(null);return this.subscriberPackages.push({subscriber:r,isFinally:t,onFulfill:i,onReject:n}),(this.isFulfilled()||this.isRejected())&&setTimeout(function(){return s.notifySubscribers()}),r},e.prototype.notifySubscribers=function(){var e=this,t=2!==this.state;this.subscriberPackages.forEach(function(i){var n,s=t?i.onFulfill:i.onReject,r=e.result;if(s)try{r=s(e.result)}catch(e){n=e}var o=i.subscriber;n?o.beRejected(n):t?o.beResolved(r):o.beRejected(r,!1,s&&!i.isFinally)}),this.subscriberPackages.length=0},e.isThenable=function(e){return this.isObjectOrFunction(e)&&this.isFunction(e.then)},e.prototype.lockIn=function(){this._lockedIn=!0},e.prototype.isLockedIn=function(){return!!this._lockedIn},Object.defineProperty(e.prototype,"state",{get:function(){return this._state||0},set:function(e){if(this.isSettled())throw new Error("Attempted to set state on a promise that's already been settled.");this._state=e,this.lockIn()},enumerable:!0,configurable:!0}),e.prototype.beResolved=function(t,i){var n=this;if(void 0===i&&(i=!1),t===this)throw new Error("Cannot resolve a promise with itself.");return!i&&this.isLockedIn()?this:this.isSettled()?this:(this.lockIn(),e.isThenable(t)?(t.then(function(e){return n.beResolved(e,!0)},function(e){return n.beRejected(e,!0)}),this):(this.state=1,this.result=t,this.notifySubscribers(),this))},e.prototype.beRejected=function(e,t,i){if(void 0===t&&(t=!1),void 0===i&&(i=!1),e===this)throw new Error("Cannot resolve a promise with itself.");return!t&&this.isLockedIn()?this:this.isSettled()?this:(this.lockIn(),this.state=i?3:2,this.result=e,this.notifySubscribers(),this)},e.prototype.getResult=function(){return this.result},e.prototype.isSettled=function(){return this.isFulfilled()||this.isRejected()},e.prototype.isPending=function(){return 0===this.state},e.prototype.isFulfilled=function(){return 1===this.state},e.prototype.isRejected=function(){return 2===this.state||3===this.state},e.isObjectOrFunction=function(e){if(null===e||void 0===e)return!1;var t=typeof e;return null!==e&&("object"===t||"function"===t)},e.isFunction=function(e){return"function"==typeof e},e}();t.GwPromise=n,window&&"function"!=typeof window.Promise&&(window.Promise=n)}])});